## 暗黑地牢肉鸽 - 需求文档（v1.1）

> 最新更新：2025-11-13  
> 负责人：AI 产品助手

---

## 1. 营地界面（Camp）概览

### 1.1 场景目标
营地界面是玩家在每次探索前的准备枢纽，需满足以下目标：
- 让玩家一眼看到当前主力角色、小队状态与资源余量；
- 方便地调整手牌（角色卡、法术、装备）与携带道具；
- 提供技能树、特性、任务与AI建议等深度玩法入口；
- 支撑商城售卖与营地设施互动（锻造、治疗、训练等）。

### 1.2 功能模组拆解
- **主角面板**：关联 `user_characters`、`character_traits`、`skills`，展示等级、生命、压力、已装备卡牌。
- **卡组管理**：读取 `user_cards`、`cards`、`card_tags`，支持手牌筛选、排序、编组。
- **背包与道具**：读取 `inventory`、`items`，显示消耗品数量、用途说明。
- **营地设施**：读取 `camp_facilities`、`camp_upgrades`、`camp_tasks`，决定当前可用的营地服务。
- **商城&货币**：读取 `shop_offers`、`user_wallets`，售卖角色卡/法术卡/装备卡与营地道具。
- **任务与事件**：关联 `events`、`camp_tasks`，给出准备目标与奖励。
- **AI助手**：基于 `game_metrics`、`runs`、`player_actions` 聚合信息，推送策略建议。

### 1.3 数据展示清单
- **角色栏**：头像、职业、等级、血量/护甲/压力、特性列表、技能树解锁情况。
- **卡组栏**：手牌总览（类型、稀有度、法力消耗）、当前牌组上限、已装备状态。
- **道具栏**：消耗品库存、用途标签、剩余购买次数。
- **营地进度**：设施等级、可参与任务、即将刷新事件时间（所有设施默认解锁）。
- **货币栏**：金币、魂晶等货币余额，未领取奖励提示。

---

## 2. 数据库重构目标

### 2.1 设计原则
- **一主多从**：区分模板类数据（全局可见）与用户实例数据（私人持有）。
- **类型抽象**：卡牌统一建模，通过类型枚举区分角色牌、法术牌、装备牌，避免重复表。
- **数据可扩展**：保留 JSON/配置字段，便于后续新增特效、数值、策划自定义。
- **营地优先**：所有营地界面数据可通过单次聚合查询获得，减少前端拼装。

### 2.2 表一览

| 表名 | 类型 | 功能说明 | 关联模块 |
|------|------|----------|----------|
| `users` | 核心表 | 用户账户信息管理 | 用户认证、角色管理 |
| `user_wallets` | 财务表 | 用户货币余额管理 | 商城、交易系统 |
| `player_characters` | 模板表 | 玩家角色模板定义 | 玩家角色、技能系统 |
| `card_characters` | 模板表 | 卡牌角色模板定义 | 卡牌角色、战斗系统 |
| `user_player_characters` | 实例表 | 玩家角色实例 | 主角面板、技能系统 |
| `user_card_characters` | 实例表 | 卡牌角色实例 | 卡牌战斗、属性系统 |
| `card_character_traits` | 属性表 | 卡牌角色特性配置 | 卡牌角色成长、属性系统 |
| `skills` | 模板表 | 玩家技能模板定义 | 技能系统（玩家主角专用） |
| `user_skills` | 实例表 | 用户技能解锁状态 | 技能树 |
| `cards` | 模板表 | 统一卡牌池（角色/法术/装备） | 卡牌系统、商城 |
| `user_cards` | 实例表 | 用户持有的卡牌实例 | 卡组管理、装备系统 |
| `items` | 模板表 | 道具与商城货品定义 | 背包、商城系统 |
| `inventory` | 实例表 | 用户背包道具持有 | 道具管理、消耗品 |
| `shop_offers` | 配置表 | 商城上架商品配置 | 商城刷新、限时活动 |
| `camp_facilities` | 模板表 | 营地设施模板定义 | 营地系统、设施升级 |
| `user_camp_facilities` | 实例表 | 用户设施状态管理 | 营地设施、等级系统 |
| `camp_upgrades` | 配置表 | 营地设施升级配置 | 设施升级、属性提升 |
| `camp_tasks` | 任务表 | 营地任务系统 | 任务追踪、奖励发放 |
| `dungeons` | 模板表 | 地牢关卡配置 | 地牢探索、难度设置 |
| `runs` | 实例表 | 地牢探索记录 | 进度追踪、战绩统计 |
| `enemies` | 模板表 | 敌人配置数据 | 战斗系统、敌人AI |
| `enemy_cards` | 关联表 | 敌人持有的卡牌 | 敌人技能、战斗行为 |
| `events` | 事件表 | 游戏事件系统 | 随机事件、剧情触发 |
| `stress_debuff_configs` | 配置表 | 压力debuff效果配置 | 压力系统、debuff管理 |
| `player_actions` | 行为表 | 玩家操作记录 | 行为分析、AI推荐 |
| `achievements` | 成就表 | 成就系统配置 | 成就解锁、进度追踪 |
| `game_metrics` | 统计表 | 游戏数据统计 | 数据分析、平衡调整 |

> **表分类说明**: 
> - **模板表**：定义游戏元素的基础属性，全局唯一
> - **实例表**：记录玩家个人持有的具体实例
> - **配置表**：游戏系统运行参数和规则定义
> - **关联表**：建立多对多关系的数据关联

---

## 3. 详细表结构说明

### 3.1 用户与角色体系

**`users`**  
| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `id` (PK) | UUID | 用户唯一标识 |
| `account_name` | VARCHAR | 显示名称/平台昵称 |
| `email` | VARCHAR | 邮箱，可为空 |
| `player_level` | INT | 玩家等级（用于技能解锁） |
| `player_exp` | BIGINT | 玩家经验值 |
| `created_at` | TIMESTAMP | 注册时间 |
| `status` | ENUM(active, banned, dormant) | 账户状态 |

**`user_wallets`**  
| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `id` (PK) | UUID | |
| `user_id` (FK→users.id) | UUID | |
| `balance` | BIGINT | 当前余额 |

**`player_characters`**（玩家角色模板库）  
| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `id` (PK) | UUID | 玩家角色模板ID |
| `code` | VARCHAR | 策划用短码 |
| `name` | VARCHAR | 角色名称 |
| **`base_hp`** | **INT** | **基础血量（用于计算最大血量）** |
| **`hp_per_level`** | **INT** | **每级增加的血量** |
| `lore` | TEXT | 背景故事 |

**`card_characters`**（卡牌角色模板库）  
| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `id` (PK) | UUID | 卡牌角色模板ID |
| `code` | VARCHAR | 策划用短码 |
| `name` | VARCHAR | 角色名称 |
| `class` | ENUM(warrior, occultist, ranger, ... ) | 职业 |
| `rarity` | ENUM(common, rare, epic, legendary) | 稀有度 |
| `base_hp` | INT | 基础血量 |
| `base_armor` | INT | 基础护甲 |
| `base_attack` | INT | 基础攻击力 |
| **`action_point_cost`** | **INT** | **上阵所需行动点** 
| `traits` | JSONB | 特性属性列表 |
| `shop_price` | JSONB | **商城售价：{currency_type, amount}** |
| `lore` | TEXT | 背景故事 |

> **设计说明**: 角色系统与压力机制设计：
> 1. **结构分离**：玩家角色（`player_characters`）和卡牌角色（`card_characters`）分别记录
> 2. **玩家角色血量系统**：玩家角色拥有血量系统，血量跨关卡继承，随等级提升最大血量
> 3. **压力系统丰富**：玩家角色拥有完整的压力值debuff系统，包含4个层级
> 4. **卡牌角色完整**：保留完整的基础属性（血量、护甲、攻击力、压力值、特性）
> 5. **获得方式单一**：**卡牌角色只能在营地商店购买获得**，无其他解锁途径
> 6. **血量与压力机制**：玩家角色血量和压力值都跨关卡持续累积，卡牌角色属性每关卡重置
> 7. **等级系统归属**：玩家等级归属于`users`表，卡牌角色无等级经验系统
> 8. **行动点系统**：为卡牌上阵添加行动点限制机制，确保每轮使用的卡牌数量有限
> 8. **行动点系统**：为卡牌上阵添加行动点限制机制，确保每轮使用的卡牌数量有限
> 8. **行动点系统**：为卡牌上阵添加行动点限制机制，确保每轮使用的卡牌数量有限


**`user_player_characters`**（玩家角色实例）  
| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `id` (PK) | UUID | 玩家角色实例ID |
| `user_id` (FK→users.id) | UUID | **玩家唯一标识** |
| `player_character_id` (FK→player_characters.id) | UUID | **玩家角色模板绑定** |
| **`max_hp`** | **INT** | **最大血量（随等级提升）** |
| **`current_hp`** | **INT** | **当前血量（跨关卡继承）** |
| **`max_action_points`** | **INT** | **最大行动点限制（随等级提升）** |
| **`current_action_points`** | **INT** | **当前剩余行动点（每轮重置）** |
| `current_stress` | INT | **当前压力值（跨关卡持续累积）** |
| `stress_level` | INT | **当前压力层级（1-4）** |
| `stress_debuffs` | JSONB | **当前激活的压力debuff列表** |

**`stress_debuff_configs`**（压力debuff配置库）  
| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `id` (PK) | UUID | debuff配置ID |
| `stress_level` | INT | **触发压力层级（1-4）** |
| `debuff_name` | VARCHAR | debuff名称 |
| `debuff_type` | ENUM(mental, combat, behavioral) | **debuff类型** |
| `effect_description` | TEXT | 效果描述 |
| `trigger_chance` | DECIMAL(3,2) | **触发概率（0.00-1.00）** |
| `effect_payload` | JSONB | **效果参数配置** |
| `is_persistent` | BOOLEAN | **是否为持续效果** |

**`user_card_characters`**（卡牌角色实例）  
| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `id` (PK) | UUID | 卡牌角色实例ID |
| `user_id` (FK→users.id) | UUID | 玩家标识 |
| `card_character_id` (FK→card_characters.id) | UUID | 卡牌角色模板绑定 |
| `current_hp` | INT | 当前血量（关卡结束重置） |
| `current_armor` | INT | 当前护甲（关卡结束重置） |
| **`is_deployed`** | **BOOLEAN** | **是否已上阵（消耗行动点）** |
| **`deployed_round`** | **INT** | **上阵轮次（用于轮次重置）** |
| **`is_deployed`** | **BOOLEAN** | **是否已上阵（消耗行动点）** |
| **`deployed_round`** | **INT** | **上阵轮次（用于轮次重置）** |

**`card_character_traits`**（卡牌角色特性）  
| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `id` (PK) | UUID | 特性ID |
| `card_character_id` (FK→card_characters.id) | UUID | 卡牌角色模板绑定 |
| `name` | VARCHAR | 特性名称 |
| `type` | ENUM(positive, negative, neutral) | 特性类型 |
| `effect_payload` | JSONB | 效果参数 |
| `description` | TEXT | 展示描述 |

### 3.2 技能系统（玩家主角专用）

**`skills`**（技能模板库）  
| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `id` (PK) | UUID | 技能模板ID |
| `code` | VARCHAR | 策划短码 |
| `name` | VARCHAR | 技能名称 |
| `description` | TEXT | 技能描述 |
| `effect_payload` | JSONB | 技能效果配置 |
| `required_level` | INT | 解锁所需玩家等级 |
| `position_in_tree` | JSONB | {row: INT, column: INT} 技能树位置 |


**`user_skills`**（用户技能实例）  
| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `id` (PK) | UUID | |
| `user_id` (FK→users.id) | UUID | 关联玩家用户 |
| `skill_id` (FK→skills.id) | UUID | |

> **修改说明**: 技能系统完全归属于玩家角色：
> 1. **角色分离**：玩家角色和卡牌角色完全分开记录和管理
> 2. **玩家角色简化**：无基础面板属性（血量、护甲、攻击力），仅保留等级和技能系统
> 3. **等级解锁**：技能通过`required_level`字段与玩家等级挂钩，单向解锁
> 4. **技能专属**：技能系统仅为玩家角色服务，卡牌角色使用卡牌系统进行战斗
> 5. **压力值机制**：玩家角色压力值跨关卡持续累积，技能解锁状态永久保留

### 3.3 卡牌系统

**`cards`**（统一卡牌池：角色、法术、装备）  
| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `id` (PK) | UUID | |
| `code` | VARCHAR | 策划短码 |
| `name` | VARCHAR | 卡牌名称 |
| `card_type` | ENUM(spell, equipment) | **卡牌类型（移除character类型）** |
| `rarity` | ENUM(common, rare, epic, legendary) | 稀有度 |
| `slot_type` | ENUM(weapon, armor, trinket, none) | 装备适用槽位（法术为 none） |
| `stat_modifiers` | JSONB | 属性变动 |
| `effect_payload` | JSONB | 生效脚本 |
| `camp_unlock_condition` | JSONB | 在营地的解锁条件 |
| `shop_price` | JSONB | {currency_type, amount} |
| `description` | TEXT | 展示描述 |

**`user_cards`**（用户持有手牌实例）  
| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `id` (PK) | UUID | |
| `user_id` (FK→users.id) | UUID | |
| `card_id` (FK→cards.id) | UUID | |
| `quantity` | INT | 持有数量（角色卡一般为1） |
| `level` | INT | 卡牌强化等级 |
| `equipped_to_user_character_id` (FK→user_characters.id) | UUID | 装备所属角色（法术为空） |
| `acquired_at` | TIMESTAMP | 获得时间 |

> **优化说明**: 添加`loadout_id`字段支持多牌组方案，明确外键约束。

> **解释**：卡牌角色（`card_characters`）已独立为单独表，只能在营地商店购买获得。
> 法术、装备存放在 `cards` 表，通过 `card_type` 区分；便于商城、构筑、掉落逻辑的统一处理。若后续需要扩展差异化字段，可在 `stat_modifiers` 或 `effect_payload` 中通过 JSON 配置。

### 3.4 道具、背包与商城

**`items`**（道具与商城货品）  
| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `id` (PK) | UUID | |
| `code` | VARCHAR | 策划短码 |
| `name` | VARCHAR | 名称 |
| `item_type` | ENUM(consumable, material, blueprint, currency_bundle, cosmetic) | 类型 |
| `rarity` | ENUM(common, rare, epic, legendary) | 稀有度 |
| `effect_payload` | JSONB | 使用效果（如治疗、增益、解锁） |
| `stack_limit` | INT | 单格堆叠上限 |
| `shop_price` | JSONB | {currency_type, amount} |
| `description` | TEXT | 说明 |

**`inventory`**（用户背包）  
| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `id` (PK) | UUID | |
| `user_id` (FK→users.id) | UUID | |
| `item_id` (FK→items.id) | UUID | |
| `quantity` | INT | 持有数量 |
| `bind_status` | ENUM(unbound, bound) | 是否绑定 |
| `last_updated_at` | TIMESTAMP | 更新时间 |

**`shop_offers`**（商城上架配置）  
| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `id` (PK) | UUID | |
| `offer_type` | ENUM(card, item, bundle) | 商品类型 |
| `target_id` | UUID | 指向 `cards.id` 或 `items.id` |
| `price` | BIGINT | 价格 |
| `display_order` | INT | 前端排序 |

### 3.5 营地设施与任务

**`camp_facilities`**  
| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `id` (PK) | UUID | |
| `code` | VARCHAR | 设施短码（forge, infirmary, library...） |
| `name` | VARCHAR | 设施名称 |
| `description` | TEXT | 功能描述 |
| `display_order` | INT | 显示顺序 |

> **修改说明**: 取消营地设施解锁功能，删除`base_unlock_condition`字段，所有设施默认解锁，新增`display_order`字段控制显示顺序。

**`camp_upgrades`**  
| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `id` (PK) | UUID | |
| `facility_id` (FK→camp_facilities.id) | UUID | |
| `tier` | INT | 等级 |
| `upgrade_effect` | JSONB | 数值或服务加成 |
| `cost` | JSONB | {currency_type, amount, material_ids} |

**`user_camp_facilities`**（用户营地设施状态）  
| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `id` (PK) | UUID | |
| `user_id` (FK→users.id) | UUID | |
| `facility_id` (FK→camp_facilities.id) | UUID | |
| `current_tier` | INT | 当前等级 |

> **修改说明**: 所有设施仅记录等级

**`camp_tasks`**  
| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `id` (PK) | UUID | |
| `facility_id` | UUID | 关联的营地设施，可空 |
| `user_id` (FK→users.id) | UUID | 关联用户 |
| `name` | VARCHAR | 任务名称 |
| `task_type` | ENUM(training, scouting, crafting, contract) | 类型 |
| `requirements` | JSONB | 角色/卡牌/道具要求 |
| `rewards` | JSONB | 奖励（货币、卡牌、道具） |
| `duration_minutes` | INT | 完成耗时 |
| `refresh_rule` | JSONB | 刷新与限时配置 |
| `status` | ENUM(available, in_progress, completed) | 任务状态 |
| `started_at` | TIMESTAMP | 开始时间 |
| `completed_at` | TIMESTAMP | 完成时间 |



> **优化说明**: 添加了`user_camp_facilities`表记录用户设施解锁状态，完善了`camp_tasks`表添加用户关联和状态管理
### 3.6 地牢探索与战斗

**`dungeons`**  
| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `id` (PK) | UUID | |
| `name` | VARCHAR | 地牢名称 |
| `difficulty` | ENUM(easy, normal, hard, expert) | 难度等级 |
| `recommended_cards` | JSONB | 推荐卡牌 |
| `description` | TEXT | 地牢描述 |

**`enemies`**  
| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `id` (PK) | UUID | |
| `name` | VARCHAR | 敌人名称 |
| `difficulty` | ENUM(easy, normal, hard, boss) | 难度 |
| `base_stats` | JSONB | 基础属性 |

**`enemy_cards`**  
| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `id` (PK) | UUID | |
| `enemy_id` (FK→enemies.id) | UUID | |
| `card_id` (FK→cards.id) | UUID | |

**`events`**  
| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `id` (PK) | UUID | |
| `name` | VARCHAR | 事件名称 |
| `location_type` | ENUM(camp, dungeon) | 事件类型 |
| `description` | TEXT | 事件描述 |

**`player_actions`**  
| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `id` (PK) | UUID | |
| `user_id` (FK→users.id) | UUID | |
| `action_type` | VARCHAR | 操作类型 |
| `source_scene` | ENUM(camp, dungeon, battle) | 场景来源 |
| `timestamp` | TIMESTAMP | 时间戳 |

> **优化说明**: 完善了地牢和战斗相关表的详细结构，明确外键约束和字段定义。

### 3.7 成就与指标

**`achievements`**  
| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `id` (PK) | UUID | |
| `name` | VARCHAR | 成就名称 |
| `category` | ENUM(progression, mastery, collection, social) | 分类 |
| `description` | TEXT | 成就描述 |
| `requirements` | JSONB | 完成条件 |

**`game_metrics`**  
| 字段 | 类型 | 说明 |
| --- | --- | --- |
| `id` (PK) | UUID | |
| `metric_type` | VARCHAR | 指标类型 |
| `date` | DATE | 统计日期 |
| `value` | BIGINT | 指标值 |

> **优化说明**: 完善了成就和指标表的详细结构。

---

## 4. 数据流与营地界面交互

1. **进入营地**  
   - 聚合查询 `user_characters`（当前角色）、`user_cards`（已装备卡）、`inventory`（可用道具）、`user_wallets`（资产）、`camp_facilities`+`camp_upgrades`（可用功能）、`camp_tasks`（任务列表）。
2. **调整牌组**  
   - 前端展示 `cards` + `user_cards`，过滤 `card_type`、`mana_cost`、`rarity`；更新时写入 `is_equipped`、`equipped_to_user_character_id`。
3. **购买商品**  
   - 读取 `shop_offers`，扣减 `user_wallets.balance`，增加 `user_cards` 或 `inventory`。
4. **道具消耗/生产**  
   - 使用消耗品更新 `inventory`；营地任务奖励也更新 `inventory` 或 `user_cards`。
5. **技能解锁与强化**  
   - 检查玩家等级 (`users.player_level`) 是否满足技能解锁条件 (`skills.required_level`)
   - 解锁技能写入 `user_skills`，同步更新玩家属性快照
   - 技能树系统通过 `prerequisite_skill_ids` 和 `position_in_tree` 管理技能解锁路径
6. **出征准备**  
   - 进入地牢前生成 `runs.preparation_snapshot`，包含手牌、道具、货币余量。
7. **关卡结束状态重置**  
   - 玩家角色血量、护甲重置为基础值，**压力值跨关卡持续累积**
   - 技能解锁状态保留，玩家等级和经验值保持不变
   - 卡牌角色状态完全重置，不保留任何进度
7. **关卡结束状态重置**  
   - 玩家角色血量、护甲重置为基础值，**压力值跨关卡持续累积**
   - 技能解锁状态保留，玩家等级和经验值保持不变
   - 卡牌角色状态完全重置，不保留任何进度
7. **关卡结束状态重置**  
   - 玩家角色血量、护甲重置为基础值，**压力值跨关卡持续累积**
   - 技能解锁状态保留，玩家等级和经验值保持不变
   - 卡牌角色状态完全重置，不保留任何进度

---

## 5. 关键问题答疑

### 5.1 用户手牌需要存哪些字段？
- 最低字段：`user_id`、`card_id`、`quantity`、`level`、`is_equipped`、`equipped_to_user_character_id`、`acquired_at`、`acquired_source`。  
- 加值字段：`last_used_at` 用于推荐常用卡、`loadout_label`（可放在 JSON）用于多套牌组方案。

### 5.2 角色、法术、装备是否要拆成多张表？
- **结论**：不需要。统一 `cards` 表，通过 `card_type` 区分，再使用 `stat_modifiers` / `effect_payload` 承载差异化配置，能确保：
  - 商城、掉落、任务奖励逻辑共用同一套代码；
  - 营地展示、筛选与排序统一处理；
  - 后续新增"传说装备"或"阵营法术"时只需新增枚举和配置。
- 如需额外的装备位校验或法术动画，可在服务层或 JSON 配置中处理。

### 5.3 道具表如何支持商城？
- `items` 作为通用道具描述表；
- `shop_offers` 负责上架逻辑，可指向 `cards` 或 `items`；
- `inventory` 只存玩家实有数量；
- 若后续需要礼包或随机箱，可扩展 `offer_type=bundle` 并在 `effect_payload` 里列出掉落池。

### 5.4 法术不需要冷却、装备无耐久如何建模？
- 在 `cards` 表中省略冷却字段，只维护 `mana_cost`；
- 装备的持续效果放入 `stat_modifiers` 或 `effect_payload`，装备槽限制通过 `slot_type` 控制；
- 若想记录装备被拆解，可以在 `player_actions` 中记录相关事件，无需额外字段。

---

## 6. 优化总结与后续待办

### 6.1 优化内容总结
1. **删除重复字段**：移除`characters`表中与`base_stats`重复的数值字段
2. **补充缺失表结构**：新增`skills`、`user_camp_facilities`、`loadouts`表
3. **完善外键约束**：为所有外键关系添加明确的约束
4. **增强功能支持**：添加多牌组方案、用户设施状态管理等功能
5. **简化营地系统**：取消营地设施解锁功能，所有设施默认解锁，删除`base_unlock_condition`和`unlocked_at`字段
6. **技能系统重构**：改为基于玩家等级解锁机制，添加玩家等级字段，建立技能树系统
6. **技能系统重构**：改为基于玩家等级解锁机制，添加玩家等级字段，建立技能树系统
5. **简化营地系统**：取消营地设施解锁功能，所有设施默认解锁，删除`base_unlock_condition`和`unlocked_at`字段

### 6.2 后续待办
1. 根据优化后的设计更新后端实体与 Mapper；
2. 调整前端 Pinia store，按新表结构拉通营地数据；
3. 为 `runs` 与 `game_metrics` 增加营地维度统计；
4. 编写营地聚合 API（返回"营地仪表盘"数据块，减少接口调用次数）。
5. 创建数据库迁移脚本，确保平滑升级。

---

## 7. 版本历史

- **v1.1（2025-11-13）**：重构营地界面数据需求，统一卡牌模型，新增商城与营地设施表设计。
- **v1.0（2023-10-27）**：初版发布，围绕 L.I.G.H.T. 架构规划整体方向。