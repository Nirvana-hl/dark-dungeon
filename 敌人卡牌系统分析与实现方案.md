# æ•Œäººå¡ç‰Œç³»ç»Ÿåˆ†æä¸å®ç°æ–¹æ¡ˆ

## ğŸ“‹ é—®é¢˜åˆ†æ

**ç”¨æˆ·éœ€æ±‚**ï¼šå®ç°é­é‡ enemy è¡¨ä¸­çš„ä¸€ä¸ªæ•Œäººæ—¶ï¼Œä¸å…¶å¯¹æˆ˜ï¼Œè¯¥æ•Œäººä¼šæŠ½å–å®ƒçš„æ‰‹ç‰Œå¹¶æ‰“å‡ºï¼Œä½†æ˜¯å®ƒçš„æ‰‹ç‰Œåº”è¯¥åŒ…å«è§’è‰²è£…å¤‡å’Œæ³•æœ¯ã€‚

## âœ… æ•°æ®åº“ç»“æ„åˆ†æ

### 1. ç›¸å…³æ•°æ®è¡¨

#### `enemies` è¡¨ï¼ˆæ•Œäººæ¨¡æ¿ï¼‰
```sql
CREATE TABLE `enemies` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `name` varchar(80) NOT NULL,
  `difficulty` varchar(20) NOT NULL,
  `base_stats` json NOT NULL,        -- åŸºç¡€å±æ€§ï¼ˆHPã€æ”»å‡»ç­‰ï¼‰
  `behavior_script` json NOT NULL,   -- è¡Œä¸ºè„šæœ¬ï¼ˆAIç­–ç•¥ï¼‰
  PRIMARY KEY (`id`)
)
```

#### `enemy_cards` è¡¨ï¼ˆæ•Œäººå¡ç»„å…³è”ï¼‰
```sql
CREATE TABLE `enemy_cards` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `enemy_id` bigint NOT NULL,        -- å…³è”æ•ŒäººID
  `card_id` bigint NOT NULL,         -- å…³è”å¡ç‰ŒID
  `weight` int NOT NULL DEFAULT 1,   -- æƒé‡ï¼ˆç”¨äºéšæœºæŠ½å–ï¼‰
  PRIMARY KEY (`id`),
  FOREIGN KEY (`enemy_id`) REFERENCES `enemies`(`id`),
  FOREIGN KEY (`card_id`) REFERENCES `cards`(`id`)
)
```

#### `cards` è¡¨ï¼ˆå¡ç‰Œæ± ï¼‰
```sql
CREATE TABLE `cards` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `code` varchar(32) NOT NULL,
  `name` varchar(80) NOT NULL,
  `card_type` varchar(20) NOT NULL,  -- 'spell'ï¼ˆæ³•æœ¯ï¼‰æˆ– 'equipment'ï¼ˆè£…å¤‡ï¼‰
  `rarity` varchar(20) NOT NULL,
  `slot_type` varchar(20),           -- è£…å¤‡æ§½ä½ï¼š'weapon'/'armor'/'trinket'/'none'
  `action_point_cost` int,           -- è¡ŒåŠ¨ç‚¹æ¶ˆè€—
  `stat_modifiers` json,             -- å±æ€§å˜åŠ¨ï¼ˆæ”»å‡»ã€é˜²å¾¡ç­‰ï¼‰
  `effect_payload` json,             -- æ•ˆæœè„šæœ¬ï¼ˆä¼¤å®³ã€æ²»ç–—ç­‰ï¼‰
  `description` text,
  PRIMARY KEY (`id`)
)
```

### 2. æ•°æ®åº“æ”¯æŒæƒ…å†µ

âœ… **å®Œå…¨æ”¯æŒ**ï¼š
- `enemy_cards` è¡¨é€šè¿‡ `card_id` å…³è”åˆ° `cards` è¡¨
- `cards` è¡¨çš„ `card_type` å­—æ®µå¯ä»¥åŒºåˆ†æ³•æœ¯ï¼ˆ`spell`ï¼‰å’Œè£…å¤‡ï¼ˆ`equipment`ï¼‰
- æ•°æ®åº“ä¸­å·²æœ‰è£…å¤‡å’Œæ³•æœ¯å¡ç‰Œçš„ç¤ºä¾‹æ•°æ®ï¼š
  - **æ³•æœ¯å¡ç‰Œ**ï¼š`holy_light`ï¼ˆåœ£å…‰æœ¯ï¼‰ã€`fireball`ï¼ˆç«çƒæœ¯ï¼‰ã€`meteor`ï¼ˆé™¨çŸ³æœ¯ï¼‰ç­‰
  - **è£…å¤‡å¡ç‰Œ**ï¼š`iron_wall`ï¼ˆé“å£æŠ¤ç”²ï¼‰ã€`blood_sword`ï¼ˆè¡€åˆƒï¼‰ã€`iron_sword`ï¼ˆé“å‰‘ï¼‰ç­‰

### 3. å½“å‰æ•°æ®ç¤ºä¾‹

```sql
-- æ•Œäººç¤ºä¾‹
INSERT INTO `enemies` VALUES (1, 'æš—å½±çŒæ‰‹', 'normal', '{"hp": 120, "armor": 5, "attack": 18}', '{"pattern": "strike_poison", "priority": "low_hp"}');

-- æ•Œäººå¡ç»„å…³è”ï¼ˆç›®å‰åªæœ‰1æ¡è®°å½•ï¼‰
INSERT INTO `enemy_cards` VALUES (1, 1, 2, 2);  -- æ•Œäºº1å…³è”å¡ç‰Œ2ï¼ˆç«çƒæœ¯ï¼‰

-- å¡ç‰Œç¤ºä¾‹
INSERT INTO `cards` VALUES (2, 'fireball', 'ç«çƒæœ¯', 'spell', 'common', 'none', 2, '{}', '{"type": "damage_single", "damage": 30}', ...);
INSERT INTO `cards` VALUES (3, 'iron_wall', 'é“å£æŠ¤ç”²', 'equipment', 'common', 'armor', 0, '{"armor": 6}', '{"type": "buff_armor"}', ...);
```

## ğŸ” ä»£ç å®ç°åˆ†æ

### 1. åç«¯å®ç°æƒ…å†µ

#### âœ… å·²å®ç°çš„åŠŸèƒ½

**`EnemyService.getEnemyCardsByEnemyId()`**ï¼š
- å¯ä»¥è·å–æŒ‡å®šæ•Œäººçš„æ‰€æœ‰å¡ç‰Œï¼ˆåŒ…æ‹¬è£…å¤‡å’Œæ³•æœ¯ï¼‰
- é€šè¿‡ `enemy_cards` è¡¨æŸ¥è¯¢å…³è”çš„ `card_id`
- ä» `cards` è¡¨è·å–å®Œæ•´çš„å¡ç‰Œä¿¡æ¯

**`EnemyService.convertToEnemyCardDTO()`**ï¼š
- èƒ½å¤Ÿæ­£ç¡®è½¬æ¢è£…å¤‡å’Œæ³•æœ¯å¡ç‰Œ
- ä» `cardType` å­—æ®µåŒºåˆ†å¡ç‰Œç±»å‹
- ä» `statModifiers` æå–å±æ€§ï¼ˆæ”»å‡»ã€é˜²å¾¡ç­‰ï¼‰
- ä» `effectPayload` æå–æ•ˆæœè„šæœ¬

**`DungeonService.prepareBattle()`**ï¼š
- åœ¨é­é‡æ•Œäººæ—¶ï¼Œä¼šè°ƒç”¨ `enemyService.getEnemyCardsByEnemyId()` è·å–æ•Œäººå¡ç‰Œ
- å°†å¡ç‰Œä¿¡æ¯å­˜å‚¨åœ¨ `RunProgressState.pendingEnemyCards` ä¸­
- é€šè¿‡ API è¿”å›ç»™å‰ç«¯

#### âš ï¸ å½“å‰é™åˆ¶

**`DungeonService.simulateBattle()`**ï¼š
- åªæ˜¯ç®€å•çš„å›åˆåˆ¶æˆ˜æ–—æ¨¡æ‹Ÿ
- æ²¡æœ‰å®é™…ä½¿ç”¨æ•Œäººçš„å¡ç‰Œ
- æ•Œäººåªæ˜¯æ ¹æ®åŸºç¡€å±æ€§è¿›è¡Œæ”»å‡»ï¼Œæ²¡æœ‰ä½¿ç”¨è£…å¤‡æˆ–æ³•æœ¯

### 2. å‰ç«¯å®ç°æƒ…å†µ

**`game.ts` ä¸­çš„æ•Œäººå‡ºç‰Œé€»è¾‘**ï¼š
- å‰ç«¯æœ‰æ•Œäººæ‰‹ç‰Œå’Œå‡ºç‰Œé€»è¾‘ï¼ˆ`enemyHand`ã€`enemyBoard`ï¼‰
- ä½†è¿™æ˜¯å‰ç«¯çš„æ¨¡æ‹Ÿæˆ˜æ–—ï¼Œä¸æ˜¯çœŸå®çš„åç«¯æˆ˜æ–—

## ğŸ’¡ å®ç°æ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€ï¼šæ”¹è¿›åç«¯æˆ˜æ–—ç³»ç»Ÿï¼ˆæ¨èï¼‰

#### 1. ä¿®æ”¹ `simulateBattle()` æ–¹æ³•

è®©æ•Œäººèƒ½å¤Ÿï¼š
- ä» `pendingEnemyCards` ä¸­æŠ½å–æ‰‹ç‰Œ
- æ ¹æ® AI ç­–ç•¥é€‰æ‹©å¡ç‰Œï¼ˆæ³•æœ¯æˆ–è£…å¤‡ï¼‰
- æ‰§è¡Œå¡ç‰Œæ•ˆæœï¼ˆä¼¤å®³ã€æ²»ç–—ã€è£…å¤‡ç­‰ï¼‰

#### 2. å®ç°æ•Œäºº AI ç­–ç•¥

æ ¹æ® `enemies.behavior_script` ä¸­çš„é…ç½®ï¼š
- **æ”»å‡»å‹**ï¼šä¼˜å…ˆä½¿ç”¨ä¼¤å®³æ³•æœ¯
- **é˜²å¾¡å‹**ï¼šä¼˜å…ˆä½¿ç”¨è£…å¤‡å’ŒæŠ¤ç›¾æ³•æœ¯
- **å¹³è¡¡å‹**ï¼šæ ¹æ®å½“å‰è¡€é‡é€‰æ‹©å¡ç‰Œ

#### 3. å¡ç‰Œæ•ˆæœæ‰§è¡Œ

- **æ³•æœ¯å¡ç‰Œ**ï¼šç«‹å³ç”Ÿæ•ˆï¼ˆä¼¤å®³ã€æ²»ç–—ã€buffç­‰ï¼‰
- **è£…å¤‡å¡ç‰Œ**ï¼šè£…å¤‡åˆ°æ•Œäººèº«ä¸Šï¼ŒæŒç»­ç”Ÿæ•ˆï¼ˆå¢åŠ æ”»å‡»ã€é˜²å¾¡ç­‰ï¼‰

### æ–¹æ¡ˆäºŒï¼šå‰ç«¯å®æ—¶æˆ˜æ–—ï¼ˆå¤æ‚ï¼‰

- å‰ç«¯ä»åç«¯è·å–æ•Œäººå¡ç‰Œ
- å‰ç«¯å®ç°å›åˆåˆ¶æˆ˜æ–—é€»è¾‘
- æ•Œäººæ ¹æ® AI ç­–ç•¥å‡ºç‰Œ
- éœ€è¦å‰åç«¯é¢‘ç¹äº¤äº’

## ğŸ¯ æ¨èå®ç°æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šå®Œå–„æ•°æ®åº“æ•°æ®

ä¸ºæ¯ä¸ªæ•Œäººæ·»åŠ æ›´å¤šå¡ç‰Œï¼ˆåŒ…æ‹¬è£…å¤‡å’Œæ³•æœ¯ï¼‰ï¼š

```sql
-- ä¸ºæš—å½±çŒæ‰‹æ·»åŠ æ›´å¤šå¡ç‰Œ
INSERT INTO `enemy_cards` (`enemy_id`, `card_id`, `weight`) VALUES
(1, 2, 3),   -- ç«çƒæœ¯ï¼ˆæ³•æœ¯ï¼‰
(1, 3, 2),   -- é“å£æŠ¤ç”²ï¼ˆè£…å¤‡ï¼‰
(1, 41, 2),  -- é“å‰‘ï¼ˆè£…å¤‡ï¼‰
(1, 34, 1);  -- æŠ¤ç›¾æœ¯ï¼ˆæ³•æœ¯ï¼‰

-- ä¸ºå…¶ä»–æ•Œäººä¹Ÿæ·»åŠ å¡ç‰Œ
INSERT INTO `enemy_cards` (`enemy_id`, `card_id`, `weight`) VALUES
(2, 35, 2),  -- è™šç©ºä¹‹æ‰‹ï¼šé™¨çŸ³æœ¯
(2, 43, 1),  -- è™šç©ºä¹‹æ‰‹ï¼šé¾™åˆƒ
(3, 2, 2),   -- ç°çƒ¬éª‘å£«ï¼šç«çƒæœ¯
(3, 45, 2);  -- ç°çƒ¬éª‘å£«ï¼šçš®ç”²
```

### ç¬¬äºŒæ­¥ï¼šæ”¹è¿› `simulateBattle()` æ–¹æ³•

```java
private BattleResultDTO simulateBattle(
    UserPlayerCharacterDTO hero, 
    Enemy enemy, 
    String strategy,
    List<Map<String, Object>> enemyCards  // æ–°å¢ï¼šæ•Œäººå¡ç‰Œåˆ—è¡¨
) {
    // 1. åˆå§‹åŒ–æ•Œäººæ‰‹ç‰Œï¼ˆä» enemyCards ä¸­éšæœºæŠ½å–ï¼‰
    List<Map<String, Object>> enemyHand = initializeEnemyHand(enemyCards);
    
    // 2. åˆå§‹åŒ–æ•Œäººè£…å¤‡æ§½ä½
    Map<String, Map<String, Object>> enemyEquipment = new HashMap<>();
    
    // 3. æˆ˜æ–—å¾ªç¯
    int round = 1;
    while (heroHp > 0 && enemyHp > 0 && round <= 20) {
        // ç©å®¶å›åˆ
        // ... ç©å®¶è¡ŒåŠ¨ ...
        
        // æ•Œäººå›åˆ
        if (enemyHp > 0) {
            // æ•ŒäººæŠ½ç‰Œï¼ˆæ¯å›åˆæŠ½1-2å¼ ï¼‰
            drawEnemyCards(enemyHand, enemyCards);
            
            // æ•Œäººé€‰æ‹©å¡ç‰Œï¼ˆæ ¹æ® AI ç­–ç•¥ï¼‰
            Map<String, Object> selectedCard = selectEnemyCard(
                enemyHand, 
                enemy, 
                heroHp, 
                enemyHp
            );
            
            // æ‰§è¡Œå¡ç‰Œæ•ˆæœ
            if (selectedCard != null) {
                executeEnemyCard(
                    selectedCard, 
                    enemy, 
                    hero, 
                    enemyEquipment
                );
            }
        }
        
        round++;
    }
    
    // ... è¿”å›æˆ˜æ–—ç»“æœ ...
}
```

### ç¬¬ä¸‰æ­¥ï¼šå®ç°æ•Œäºº AI ç­–ç•¥

```java
private Map<String, Object> selectEnemyCard(
    List<Map<String, Object>> enemyHand,
    Enemy enemy,
    int heroHp,
    int enemyHp
) {
    // è§£æè¡Œä¸ºè„šæœ¬
    JSONObject behavior = JSON.parseObject(enemy.getBehaviorScript());
    String pattern = behavior.getString("pattern");
    String priority = behavior.getString("priority");
    
    // æ ¹æ®ç­–ç•¥é€‰æ‹©å¡ç‰Œ
    if ("strike_poison".equals(pattern)) {
        // ä¼˜å…ˆä½¿ç”¨ä¼¤å®³æ³•æœ¯
        return enemyHand.stream()
            .filter(card -> "spell".equals(card.get("type")))
            .filter(card -> hasDamageEffect(card))
            .findFirst()
            .orElse(null);
    } else if ("aoe_then_shield".equals(pattern)) {
        // å…ˆä½¿ç”¨AOEï¼Œå†ä½¿ç”¨æŠ¤ç›¾
        // ...
    }
    
    // é»˜è®¤ï¼šéšæœºé€‰æ‹©ä¸€å¼ å¡ç‰Œ
    return enemyHand.isEmpty() ? null : enemyHand.get(RANDOM.nextInt(enemyHand.size()));
}
```

### ç¬¬å››æ­¥ï¼šå®ç°å¡ç‰Œæ•ˆæœæ‰§è¡Œ

```java
private void executeEnemyCard(
    Map<String, Object> card,
    Enemy enemy,
    UserPlayerCharacterDTO hero,
    Map<String, Map<String, Object>> enemyEquipment
) {
    String cardType = (String) card.get("type");
    
    if ("spell".equals(cardType)) {
        // æ‰§è¡Œæ³•æœ¯æ•ˆæœ
        executeSpell(card, enemy, hero);
    } else if ("equipment".equals(cardType)) {
        // è£…å¤‡å¡ç‰Œ
        equipCard(card, enemy, enemyEquipment);
    }
}

private void executeSpell(Map<String, Object> card, Enemy enemy, UserPlayerCharacterDTO hero) {
    String effectPayload = (String) card.get("effect");
    JSONObject effect = JSON.parseObject(effectPayload);
    
    String effectType = effect.getString("type");
    if ("damage_single".equals(effectType)) {
        int damage = effect.getIntValue("damage", 0);
        // å¯¹ç©å®¶é€ æˆä¼¤å®³
        // ...
    } else if ("heal_single".equals(effectType)) {
        int heal = effect.getIntValue("heal_amount", 0);
        // æ²»ç–—æ•Œäºº
        // ...
    }
    // ... å…¶ä»–æ•ˆæœ ...
}

private void equipCard(
    Map<String, Object> card,
    Enemy enemy,
    Map<String, Map<String, Object>> enemyEquipment
) {
    String slotType = (String) card.get("slotType");
    if (slotType != null && !"none".equals(slotType)) {
        enemyEquipment.put(slotType, card);
        // åº”ç”¨è£…å¤‡å±æ€§åŠ æˆ
        // ...
    }
}
```

## ğŸ“Š æ€»ç»“

### âœ… å¯ä»¥å®ç°

**æ•°æ®åº“å±‚é¢**ï¼š
- âœ… `enemy_cards` è¡¨å·²ç»å…³è”äº† `cards` è¡¨
- âœ… `cards` è¡¨å¯ä»¥å­˜å‚¨è£…å¤‡å’Œæ³•æœ¯å¡ç‰Œ
- âœ… æ•°æ®ç»“æ„å®Œå…¨æ”¯æŒéœ€æ±‚

**ä»£ç å±‚é¢**ï¼š
- âœ… `EnemyService` å·²ç»å¯ä»¥è·å–æ•Œäººçš„æ‰€æœ‰å¡ç‰Œï¼ˆåŒ…æ‹¬è£…å¤‡å’Œæ³•æœ¯ï¼‰
- âœ… å¡ç‰Œè½¬æ¢æ–¹æ³•å·²ç»èƒ½å¤ŸåŒºåˆ†è£…å¤‡å’Œæ³•æœ¯
- âš ï¸ éœ€è¦æ”¹è¿› `simulateBattle()` æ–¹æ³•ï¼Œè®©æ•Œäººå®é™…ä½¿ç”¨å¡ç‰Œ

### ğŸ¯ å®ç°å»ºè®®

1. **çŸ­æœŸ**ï¼šå®Œå–„æ•°æ®åº“æ•°æ®ï¼Œä¸ºæ¯ä¸ªæ•Œäººæ·»åŠ è£…å¤‡å’Œæ³•æœ¯å¡ç‰Œ
2. **ä¸­æœŸ**ï¼šæ”¹è¿› `simulateBattle()` æ–¹æ³•ï¼Œå®ç°æ•ŒäººæŠ½ç‰Œå’Œå‡ºç‰Œé€»è¾‘
3. **é•¿æœŸ**ï¼šå®ç°æ›´å¤æ‚çš„ AI ç­–ç•¥ï¼Œè®©æ•Œäººæ ¹æ®æˆ˜å†µæ™ºèƒ½é€‰æ‹©å¡ç‰Œ

### ğŸ“ æ³¨æ„äº‹é¡¹

1. **è£…å¤‡å¡ç‰Œ**ï¼šæ•Œäººè£…å¤‡ååº”è¯¥æŒç»­ç”Ÿæ•ˆï¼Œç›´åˆ°æˆ˜æ–—ç»“æŸæˆ–è¢«æ›¿æ¢
2. **æ³•æœ¯å¡ç‰Œ**ï¼šæ•Œäººä½¿ç”¨åç«‹å³ç”Ÿæ•ˆï¼Œç„¶åä»æ‰‹ç‰Œä¸­ç§»é™¤
3. **è§’è‰²å¡ç‰Œ**ï¼šæ•Œäººå¯ä»¥æŠ½å–è§’è‰²å¡ï¼Œä¸Šé˜µåä½œä¸ºæˆ˜æ–—å•ä½
4. **æ‰‹ç‰Œç®¡ç†**ï¼šæ•Œäººåº”è¯¥æœ‰æ‰‹ç‰Œä¸Šé™ï¼ˆå¦‚5-7å¼ ï¼‰ï¼Œè¶…è¿‡ä¸Šé™éœ€è¦å¼ƒç‰Œ
5. **AI ç­–ç•¥**ï¼šæ ¹æ® `behavior_script` é…ç½®å®ç°ä¸åŒçš„å‡ºç‰Œç­–ç•¥

## âœ… å®ç°å®Œæˆï¼ˆ2025-12-04ï¼‰

### å·²å®Œæˆçš„ä¿®æ”¹

1. **æ•°æ®åº“è¡¨åˆ›å»º**ï¼š
   - âœ… åˆ›å»ºäº† `enemy_card_characters` è¡¨ï¼Œç”¨äºå…³è”æ•Œäººå’Œè§’è‰²å¡
   - âœ… æ·»åŠ äº†ç¤ºä¾‹æ•°æ®ï¼Œä¸ºç°æœ‰æ•Œäººé…ç½®äº†è§’è‰²å¡

2. **åç«¯ä»£ç å®ç°**ï¼š
   - âœ… åˆ›å»ºäº† `EnemyCardCharacter` å®ä½“ç±»
   - âœ… åˆ›å»ºäº† `EnemyCardCharacterMapper` æ¥å£
   - âœ… åœ¨ `EnemyService` ä¸­æ·»åŠ äº† `getEnemyCardCharactersByEnemyId()` æ–¹æ³•
   - âœ… å®ç°äº† `convertToEnemyCardCharacterDTO()` æ–¹æ³•ï¼Œå°†è§’è‰²å¡è½¬æ¢ä¸ºå‰ç«¯æ ¼å¼
   - âœ… ä¿®æ”¹äº† `getEnemyCardsByEnemyId()` æ–¹æ³•ï¼Œè‡ªåŠ¨åˆå¹¶æ•Œäººçš„å¡ç‰Œå’Œè§’è‰²å¡

3. **åŠŸèƒ½è¯´æ˜**ï¼š
   - æ•Œäººç°åœ¨å¯ä»¥ä» `enemy_cards` è¡¨è·å–æ³•æœ¯/è£…å¤‡å¡ç‰Œ
   - æ•Œäººç°åœ¨å¯ä»¥ä» `enemy_card_characters` è¡¨è·å–è§’è‰²å¡
   - æˆ˜æ–—å‡†å¤‡æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆå¹¶ä¸¤ç§ç±»å‹çš„å¡ç‰Œï¼Œç»Ÿä¸€è¿”å›ç»™å‰ç«¯

### ä½¿ç”¨æ–¹æ³•

1. **æ‰§è¡Œæ•°æ®åº“è¿ç§»**ï¼š
   ```sql
   -- æ‰§è¡Œ database/add_enemy_card_characters_table.sql
   ```

2. **ä¸ºæ•Œäººé…ç½®è§’è‰²å¡**ï¼š
   ```sql
   INSERT INTO `enemy_card_characters` (`enemy_id`, `card_character_id`, `weight`) VALUES
   (1, 4, 3),  -- æ•Œäºº1å…³è”è§’è‰²å¡4ï¼Œæƒé‡3
   (1, 10, 2); -- æ•Œäºº1å…³è”è§’è‰²å¡10ï¼Œæƒé‡2
   ```

3. **API è°ƒç”¨**ï¼š
   - å½“é­é‡æ•Œäººæ—¶ï¼Œ`GET /dungeons/runs/{runId}/explore` è¿”å›çš„ `pendingEnemyCards` å­—æ®µä¼šåŒ…å«ï¼š
     - æ³•æœ¯/è£…å¤‡å¡ç‰Œï¼ˆä» `enemy_cards` è¡¨ï¼‰
     - è§’è‰²å¡ï¼ˆä» `enemy_card_characters` è¡¨ï¼‰
   - æ‰€æœ‰å¡ç‰Œç»Ÿä¸€åœ¨ `pendingEnemyCards` åˆ—è¡¨ä¸­ï¼Œé€šè¿‡ `type` å­—æ®µåŒºåˆ†ï¼š
     - `type: "spell"` - æ³•æœ¯å¡ç‰Œ
     - `type: "equipment"` - è£…å¤‡å¡ç‰Œ
     - `type: "character"` - è§’è‰²å¡

### ä¸‹ä¸€æ­¥

1. **å‰ç«¯é€‚é…**ï¼šå‰ç«¯éœ€è¦è¯†åˆ« `type: "character"` çš„å¡ç‰Œï¼Œå¹¶æŒ‰ç…§è§’è‰²å¡çš„æ–¹å¼å¤„ç†
2. **æˆ˜æ–—ç³»ç»Ÿæ”¹è¿›**ï¼šåœ¨ `simulateBattle()` æ–¹æ³•ä¸­å®ç°æ•Œäººä½¿ç”¨è§’è‰²å¡çš„é€»è¾‘
3. **AI ç­–ç•¥**ï¼šæ ¹æ® `behavior_script` å®ç°æ•Œäººé€‰æ‹©å’Œä½¿ç”¨è§’è‰²å¡çš„ç­–ç•¥

---

**æœ€åæ›´æ–°**ï¼š2025-12-04  
**åˆ†æäºº**ï¼šAIåŠ©æ‰‹

