# 项目启动问题诊断报告

## 🔍 发现的问题

### 1. PowerShell 语法问题 ✅ 已解决
**问题**: PowerShell 不支持 `&&` 语法
- **错误信息**: `标记"&&"不是此版本中的有效语句分隔符`
- **解决方案**: 已创建 PowerShell 启动脚本（`启动后端.ps1`、`启动前端.ps1`、`启动项目.ps1`）

### 2. API 路径不匹配 ⚠️ 需要修复
**问题**: 前端和后端的 API 路径不一致
- **前端配置**: `http://localhost:8080/api` (在 `frontend/src/lib/api.ts`)
- **后端路径**: 后端 Controller 没有 `/api` 前缀
  - `/camp/dashboard` (实际路径)
  - `/character/traits` (实际路径)
  - `/achievements` (实际路径)

**影响**: 前端无法正确调用后端 API

**解决方案（二选一）**:
- **方案A**: 修改前端 API 配置，移除 `/api` 前缀
- **方案B**: 在后端添加全局 `/api` 前缀

### 3. 数据库连接 ⚠️ 需要确认
**问题**: 后端配置使用 MySQL，需要确认：
- MySQL 服务是否运行
- 数据库 `dark_dungeon` 是否已创建
- 用户名和密码是否正确（root/123456）

**检查方法**:
```sql
-- 连接到 MySQL
mysql -u root -p

-- 检查数据库是否存在
SHOW DATABASES LIKE 'dark_dungeon';

-- 如果不存在，创建数据库
CREATE DATABASE dark_dungeon CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 4. 端口占用 ⚠️ 需要检查
**问题**: 端口可能被占用
- 后端端口: 8080
- 前端端口: 5180

**检查方法**:
```powershell
# 检查端口占用
netstat -ano | findstr ":8080"
netstat -ano | findstr ":5180"
```

## 🚀 启动步骤

### 方法1: 使用启动脚本（推荐）

1. **启动所有服务**:
   ```powershell
   .\启动项目.ps1
   ```

2. **或分别启动**:
   ```powershell
   # 启动后端（新窗口）
   .\启动后端.ps1
   
   # 启动前端（新窗口）
   .\启动前端.ps1
   ```

### 方法2: 手动启动

#### 启动后端
```powershell
cd backend
mvn spring-boot:run
```

#### 启动前端
```powershell
cd frontend
npm run dev
```

## 🔧 修复建议

### 修复 API 路径问题

**推荐方案**: 修改前端 API 配置，移除 `/api` 前缀

修改 `frontend/src/lib/api.ts`:
```typescript
// 修改前
const API_BASE_URL = 'http://localhost:8080/api'

// 修改后
const API_BASE_URL = 'http://localhost:8080'
```

### 或者：在后端添加全局前缀

在 `backend/src/main/resources/application.yml` 添加:
```yaml
server:
  servlet:
    context-path: /api
```

## ✅ 验证步骤

1. **检查后端是否启动**:
   - 访问: http://localhost:8080/actuator/health (如果配置了)
   - 或访问: http://localhost:8080/h2-console (H2 控制台)

2. **检查前端是否启动**:
   - 访问: http://localhost:5180

3. **检查 API 连接**:
   - 打开浏览器开发者工具
   - 查看 Network 标签
   - 检查 API 请求是否成功

## 📝 常见问题

### Q: 后端启动失败，提示数据库连接错误
**A**: 
1. 确认 MySQL 服务已启动
2. 确认数据库 `dark_dungeon` 已创建
3. 检查 `application.yml` 中的数据库配置

### Q: 前端启动失败，提示端口被占用
**A**: 
1. 关闭占用端口的进程
2. 或修改 `vite.config.ts` 中的端口号

### Q: 前端无法调用后端 API
**A**: 
1. 检查后端是否正常运行
2. 检查 API 路径是否正确（前端是否有 `/api` 前缀）
3. 检查跨域配置是否正确

## 🎯 下一步

1. ✅ 修复 API 路径不匹配问题
2. ✅ 确认数据库连接正常
3. ✅ 测试前后端连接
4. ✅ 验证核心功能是否正常

