# 暗黑地牢肉鸽 - 两人团队开发分工方案

> 最后更新：2025-01-XX  
> 适用版本：v1.1

---

## 📋 分工原则

### 核心原则
1. **前后端分离**：一人专注后端API开发，一人专注前端UI开发
2. **接口先行**：先定义API接口规范，再并行开发
3. **优先级明确**：按功能模块优先级逐步实现
4. **及时沟通**：每日同步进度，遇到接口变更及时通知

### 协作方式
- **每日站会**：每天开始前10分钟，同步昨日完成和今日计划
- **接口文档**：使用统一的API文档（可在README中维护）
- **Git工作流**：使用分支开发，功能完成后合并到主分支

---

## 👥 角色分工

### 👨‍💻 后端开发（开发者A）
**职责范围**：
- 数据库迁移与表结构实现
- RESTful API 设计与开发
- 业务逻辑实现（Service层）
- 数据访问层（Mapper层）
- API接口文档维护

**技术栈**：
- Spring Boot + MyBatis Plus
- MySQL数据库
- JWT认证
- RESTful API设计

### 👩‍💻 前端开发（开发者B）
**职责范围**：
- 用户界面设计与实现
- 前端状态管理（Pinia）
- API调用与数据处理
- 用户交互逻辑
- 前端路由与页面跳转

**技术栈**：
- Vue 3 + TypeScript
- Pinia状态管理
- Vue Router
- Axios API调用
- Tailwind CSS

---

## 🗓️ 开发阶段规划

### 第一阶段：基础准备（1-2天）
**目标**：完成数据库迁移和基础环境搭建

#### 后端任务（开发者A）
- [ ] 执行数据库迁移脚本（`database/schema_v1_1_mysql.sql`）
- [ ] 创建所有Entity实体类（对应v1.1表结构）
- [ ] 创建所有Mapper接口（MyBatis Plus）
- [ ] 配置数据库连接（application.yml）
- [ ] 验证数据库连接和表结构

#### 前端任务（开发者B）
- [ ] 检查并更新前端依赖
- [ ] 配置API基础URL（`src/lib/api.ts`）
- [ ] 创建API接口类型定义（TypeScript interfaces）
- [ ] 更新Pinia stores结构（按新表结构）
- [ ] 准备UI组件库和样式规范

**交付物**：
- ✅ 数据库表结构完整
- ✅ 后端实体类完整
- ✅ 前端API类型定义完整

---

### 第二阶段：核心功能 - 营地界面（3-5天）
**目标**：实现营地界面的核心功能

#### 后端任务（开发者A）

**优先级1：用户与角色系统**
- [ ] 完善 `UserMapper` 和 `UserService`
- [ ] 实现 `PlayerCharacterController`（玩家角色模板查询）
- [ ] 实现 `UserPlayerCharacterController`（玩家角色实例CRUD）
  - GET `/api/player-characters` - 获取玩家角色模板列表
  - GET `/api/user-player-characters` - 获取当前用户的角色实例
  - POST `/api/user-player-characters` - 创建角色实例
  - PUT `/api/user-player-characters/{id}` - 更新角色状态（血量、压力等）
- [ ] 实现压力系统逻辑（`stress_debuff_configs`查询与应用）

**优先级2：卡牌系统**
- [ ] 实现 `CardCharacterController`（卡牌角色模板）
- [ ] 实现 `UserCardCharacterController`（用户持有的卡牌角色）
- [ ] 实现 `CardController`（法术/装备卡牌）
- [ ] 实现 `UserCardController`（用户手牌管理）
  - GET `/api/cards` - 获取卡牌模板列表
  - GET `/api/user-cards` - 获取用户手牌
  - POST `/api/user-cards/equip` - 装备卡牌
  - POST `/api/user-cards/unequip` - 卸下卡牌

**优先级3：营地聚合API**
- [ ] 实现 `CampController` - 营地数据聚合接口
  - GET `/api/camp/dashboard` - 获取营地仪表盘数据（一次性返回所有营地需要的数据）
    ```json
    {
      "userPlayerCharacter": {...},      // 玩家角色状态
      "userCardCharacters": [...],        // 已持有的卡牌角色
      "userCards": [...],                 // 手牌列表
      "inventory": [...],                 // 背包道具
      "wallet": {...},                    // 钱包余额
      "shopOffers": [...]                 // 商城商品
    }
    ```

#### 前端任务（开发者B）

**优先级1：营地界面布局**
- [ ] 设计并实现 `Camp.vue` 页面布局
  - 角色面板区域
  - 卡组管理区域
  - 背包道具区域
  - 商城区域
  - 任务/事件区域
- [ ] 创建相关子组件
  - `CharacterPanel.vue` - 角色信息展示
  - `CardDeckManager.vue` - 卡组管理
  - `InventoryPanel.vue` - 背包展示
  - `ShopPanel.vue` - 商城展示

**优先级2：状态管理**
- [ ] 更新 `stores/camp.ts` - 营地状态管理
- [ ] 更新 `stores/characters.ts` - 角色状态管理
- [ ] 更新 `stores/wallet.ts` - 钱包状态管理
- [ ] 创建 `stores/inventory.ts` - 背包状态管理
- [ ] 创建 `stores/shop.ts` - 商城状态管理

**优先级3：API集成**
- [ ] 在 `src/lib/api.ts` 中添加所有营地相关API调用
- [ ] 实现数据获取和状态更新逻辑
- [ ] 实现错误处理和加载状态

**协作点**：
- 后端先提供 `CampController` 的接口定义（可以先用Mock数据）
- 前端根据接口定义先实现UI，等后端完成后对接真实数据

---

### 第三阶段：技能系统（2-3天）

#### 后端任务（开发者A）
- [ ] 实现 `SkillController`
  - GET `/api/skills/{playerCharacterCode}` - 获取职业技能树
  - GET `/api/user-skills` - 获取用户已解锁技能
  - POST `/api/user-skills/unlock` - 解锁技能
- [ ] 实现技能解锁逻辑（检查等级、前置技能）

#### 前端任务（开发者B）
- [ ] 创建 `Skills.vue` 页面
- [ ] 实现技能树可视化组件
- [ ] 实现技能解锁交互

---

### 第四阶段：商城与道具系统（2-3天）

#### 后端任务（开发者A）
- [ ] 实现 `ShopController`
  - GET `/api/shop/offers` - 获取商城商品列表
  - POST `/api/shop/purchase` - 购买商品
- [ ] 实现 `ItemController`
  - GET `/api/items` - 获取道具模板
  - GET `/api/inventory` - 获取用户背包
  - POST `/api/inventory/use` - 使用道具
- [ ] 实现购买逻辑（扣款、发放物品）

#### 前端任务（开发者B）
- [ ] 完善 `ShopPanel.vue` 组件
- [ ] 实现购买流程UI
- [ ] 实现道具使用交互
- [ ] 添加购买成功/失败提示

---

### 第五阶段：地牢探索与战斗（4-6天）

#### 后端任务（开发者A）
- [ ] 实现 `DungeonController`
  - GET `/api/dungeons` - 获取地牢列表
  - POST `/api/runs/start` - 开始探索
  - POST `/api/runs/end` - 结束探索
- [ ] 实现 `EnemyController` - 敌人数据
- [ ] 实现战斗逻辑（伤害计算、回合制）
- [ ] 实现关卡结束状态重置逻辑

#### 前端任务（开发者B）
- [ ] 完善 `Explore.vue` 页面
- [ ] 完善 `BattleField.vue` 战斗组件
- [ ] 实现战斗流程UI
- [ ] 实现探索进度展示

---

### 第六阶段：成就与统计（2-3天）

#### 后端任务（开发者A）
- [ ] 实现 `AchievementController`
- [ ] 实现 `GameMetricsController`
- [ ] 实现数据统计逻辑

#### 前端任务（开发者B）
- [ ] 创建成就展示页面
- [ ] 实现统计面板
- [ ] 添加成就解锁提示

---

## 📝 API接口规范

### 统一响应格式
```typescript
interface ApiResponse<T> {
  code: number;      // 200表示成功，其他表示错误
  message: string;   // 提示信息
  data: T;           // 数据内容
}
```

### 统一错误处理
- 400: 请求参数错误
- 401: 未授权（需要登录）
- 403: 无权限
- 404: 资源不存在
- 500: 服务器错误

### 认证方式
所有需要认证的接口，在请求头中添加：
```
Authorization: Bearer {token}
```

---

## 🔄 协作流程

### 1. 接口定义阶段
1. 后端开发者先设计API接口（可以写在文档中）
2. 前端开发者review接口设计，提出建议
3. 双方确认后，后端开始实现，前端开始UI设计

### 2. 开发阶段
1. 后端可以先返回Mock数据，让前端先开发UI
2. 后端完成后，替换为真实数据
3. 前端对接真实接口，测试功能

### 3. 联调阶段
1. 前后端一起测试完整流程
2. 发现问题及时修复
3. 确保功能符合需求文档

### 4. 代码提交规范
- 功能分支命名：`feature/模块名-功能名`
- 提交信息格式：`[后端/前端] feat: 功能描述`
- 示例：`[后端] feat: 实现营地聚合API`

---

## 📚 参考文档

- [需求文档.md](./需求文档.md) - 产品需求详细说明
- [README.md](./README.md) - 项目整体说明
- [database/schema_v1_1_mysql.sql](./database/schema_v1_1_mysql.sql) - 数据库表结构

---

## ⚠️ 注意事项

### 后端开发者注意
1. **数据库字段类型**：严格按照 `schema_v1_1_mysql.sql` 中的定义
2. **UUID使用**：所有ID使用UUID（CHAR(36)），不是自增ID
3. **JSON字段**：MySQL的JSON字段需要特殊处理
4. **事务管理**：涉及多表操作时，注意事务一致性
5. **接口文档**：每完成一个Controller，及时更新API文档

### 前端开发者注意
1. **类型安全**：所有API调用都要定义TypeScript类型
2. **错误处理**：所有API调用都要有错误处理
3. **加载状态**：数据加载时显示loading状态
4. **用户体验**：操作成功/失败要有明确提示
5. **响应式设计**：考虑不同屏幕尺寸的适配

### 共同注意
1. **数据一致性**：前后端对同一字段的理解要一致
2. **时间格式**：统一使用ISO 8601格式（如：2025-01-15T10:30:00Z）
3. **枚举值**：前后端枚举值要保持一致
4. **测试数据**：开发时使用固定的测试数据，便于调试

---

## 🎯 第一周目标

**完成第一阶段和第二阶段的核心功能**

- ✅ 数据库迁移完成
- ✅ 营地界面基础布局完成
- ✅ 角色系统API和UI完成
- ✅ 卡牌系统API和UI完成
- ✅ 营地聚合API完成

---

## 📞 沟通方式

- **日常沟通**：使用即时通讯工具（微信/钉钉等）
- **问题记录**：使用GitHub Issues或文档记录
- **代码Review**：通过Git Pull Request进行

---

**最后更新**: 2025-01-XX | **维护者**: 项目团队

