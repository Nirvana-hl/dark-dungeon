# 商店界面使用说明

## 📋 功能说明

商店界面已按照提供的设计图重新实现，包含以下功能：

### 1. 顶部头部
- **左侧**：金色商店图标 + "神秘商店"文字
- **右侧**：金币图标 + 当前金币余额（自动格式化：K/M）

### 2. 导航标签页
- **角色**：显示角色卡牌商品
- **法术**：显示法术卡牌商品
- **装备**：显示装备道具商品
- 点击切换标签页，自动加载对应类型的商品

### 3. 特色区域（NPC介绍）
- **左侧**：NPC圆形头像（根据标签页显示不同NPC）
- **右侧**：欢迎消息（根据标签页显示不同欢迎语）

### 4. 刷新按钮
- **绿色按钮**：显示"刷新商品"文字
- **刷新费用**：50金币（显示在按钮右侧）
- **功能**：点击后刷新当前标签页的商品列表
- **状态**：余额不足时按钮禁用

### 5. 商品展示区域
- **标题栏**：
  - 左侧：礼物图标 + 商品类型名称（如"角色商品"）
  - 右侧：显示商品数量（如"本次展示6件"）
- **商品网格**：3列布局，每个商品卡片包含：
  - 商品图片（顶部）
  - 价格标签（右上角，金色）
  - 商品名称（左下角）
  - 稀有度标签（药丸形状，不同颜色）
  - 描述（金色星星图标 + 文字）
  - 购买按钮（底部）

### 6. 商品卡片交互
- **点击卡片**：查看商品详情（可扩展）
- **点击购买按钮**：直接购买商品
- **余额不足**：购买按钮显示"余额不足"并禁用

## 🖼️ 图片存储方案

### 图片目录结构

```
frontend/
└── static/
    └── images/
        └── shop/
            ├── characters/      # 角色图片
            │   ├── {characterId}.png
            │   └── default.png
            ├── cards/           # 卡牌图片
            │   ├── {cardId}.png
            │   └── default.png
            ├── items/           # 道具图片
            │   ├── {itemId}.png
            │   └── default.png
            ├── npc_warrior.png  # 战士NPC头像
            ├── npc_mage.png     # 法师NPC头像
            ├── npc_blacksmith.png # 铁匠NPC头像
            └── default.png      # 默认图片
```

### 图片命名规则

1. **商品图片**：
   - 角色：`/static/images/shop/characters/{cardCharacter.id}.png`
   - 卡牌：`/static/images/shop/cards/{card.id}.png`
   - 道具：`/static/images/shop/items/{item.id}.png`
   - 如果图片不存在，自动使用 `default.png`

2. **NPC头像**：
   - 战士：`/static/images/shop/npc_warrior.png`
   - 法师：`/static/images/shop/npc_mage.png`
   - 铁匠：`/static/images/shop/npc_blacksmith.png`

### 图片规格建议

1. **商品卡片图片**：
   - 尺寸：300x300px 或 400x400px
   - 格式：PNG（支持透明）或 JPG
   - 大小：< 200KB（优化后）

2. **NPC头像**：
   - 尺寸：240x240px（圆形显示）
   - 格式：PNG（支持透明）
   - 大小：< 100KB

3. **默认图片**：
   - 尺寸：300x300px
   - 格式：PNG
   - 内容：通用占位图

## 🔌 后端接口连接

### 已连接的接口

1. **获取商品列表**：
   - 接口：`GET /camp/shop-offers/{shopType}`
   - 参数：`shopType` = `'card_character'` | `'card'` | `'item'`
   - 返回：商品列表（最多8个）

2. **刷新商店**：
   - 接口：`POST /camp/refresh-shop/{shopType}`
   - 参数：`shopType` = `'card_character'` | `'card'` | `'item'`
   - 费用：50金币（自动扣除）
   - 返回：刷新后的商品列表

3. **购买商品**：
   - 接口：`POST /camp/purchase`
   - 参数：`{ shopOfferId: number, quantity: number }`
   - 返回：购买结果

4. **获取钱包余额**：
   - 接口：`GET /wallet/info`
   - 返回：钱包列表（包含金币余额）

### 数据格式

**商品数据结构**：
```typescript
{
  id: string | number,
  offerType: 'card_character' | 'card' | 'item',
  price: number,
  cardCharacter?: {
    id: number,
    name: string,
    description: string,
    rarity: 'common' | 'rare' | 'epic' | 'legendary',
    traits?: Array<{
      name: string,
      description: string
    }>
  },
  card?: {
    id: number,
    name: string,
    description: string,
    rarity: 'common' | 'rare' | 'epic' | 'legendary'
  },
  item?: {
    id: number,
    name: string,
    description: string,
    rarity: 'common' | 'rare' | 'epic' | 'legendary'
  }
}
```

## 🎨 样式特性

### 稀有度颜色

- **普通（Common）**：灰色边框和标签
- **稀有（Rare）**：蓝色边框和标签，带蓝色光效
- **史诗（Epic）**：紫色边框和标签，带紫色光效
- **传说（Legendary）**：橙色边框和标签，带橙色光效

### 响应式设计

- **桌面端**：3列网格布局
- **移动端**：2列网格布局（屏幕宽度 < 768px）

## 📝 使用步骤

### 1. 准备图片资源

将商品图片放入对应目录：
```bash
# 创建目录
mkdir -p frontend/static/images/shop/{characters,cards,items}

# 添加商品图片
# 角色图片：frontend/static/images/shop/characters/1.png
# 卡牌图片：frontend/static/images/shop/cards/1.png
# 道具图片：frontend/static/images/shop/items/1.png

# 添加NPC头像
# frontend/static/images/shop/npc_warrior.png
# frontend/static/images/shop/npc_mage.png
# frontend/static/images/shop/npc_blacksmith.png

# 添加默认图片
# frontend/static/images/shop/default.png
```

### 2. 启动应用

```bash
# 启动前端
cd frontend
npm run dev

# 启动后端（确保后端服务运行在 http://127.0.0.1:8080）
```

### 3. 访问商店

在浏览器中访问：`http://localhost:5180/pages/shop/shop`

## ⚠️ 注意事项

1. **图片路径**：确保图片路径正确，使用相对路径 `/static/images/shop/...`
2. **图片加载失败**：如果图片不存在，会自动使用默认图片
3. **余额不足**：刷新和购买功能会检查余额，余额不足时按钮禁用
4. **网络错误**：所有API调用都有错误处理，失败时会显示提示信息
5. **数据刷新**：购买或刷新后会自动更新商品列表和钱包余额

## 🔧 扩展功能

### 商品详情弹窗

可以在 `showProductDetail()` 函数中实现商品详情弹窗，显示：
- 商品大图
- 详细描述
- 属性信息
- 购买选项

### 图片懒加载

可以添加图片懒加载功能，提升性能：
```vue
<image 
  :src="getProductImage(offer)" 
  :lazy-load="true"
  mode="aspectFill"
/>
```

### 图片预加载

可以在商品加载时预加载图片，提升用户体验。

## 📞 问题排查

### 商品不显示
1. 检查后端接口是否正常返回数据
2. 检查控制台是否有错误信息
3. 检查商品类型是否匹配当前标签页

### 图片不显示
1. 检查图片路径是否正确
2. 检查图片文件是否存在
3. 检查浏览器控制台是否有404错误

### 购买失败
1. 检查余额是否足够
2. 检查后端接口是否正常
3. 查看控制台错误信息

