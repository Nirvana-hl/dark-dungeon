# 🚨 立即修复步骤 - 解决 app.json 找不到问题

## 问题根源

项目中的 `vite.config.ts` 和 `index.html` 让 HBuilderX 误判为 Vite 项目，导致使用 Vite 编译（生成 `index.html`）而不是 uni-app 编译（生成 `app.json`）。

## ✅ 立即执行的修复步骤

### 步骤 1：重命名/移动文件（必须！）

**方法 A：手动重命名（推荐）**

1. 在文件管理器中打开 `frontend` 目录
2. 将 `vite.config.ts` 重命名为 `vite.config.ts.bak`
3. 将 `index.html` 重命名为 `index.html.bak`

**方法 B：使用命令行**

在 `frontend` 目录下执行：

```powershell
# PowerShell
Rename-Item vite.config.ts vite.config.ts.bak
Rename-Item index.html index.html.bak
```

```bash
# Git Bash / CMD
ren vite.config.ts vite.config.ts.bak
ren index.html index.html.bak
```

### 步骤 2：清理编译输出

删除 `frontend/unpackage` 目录（如果存在）

```powershell
Remove-Item -Recurse -Force unpackage
```

### 步骤 3：检查 HBuilderX 运行设置

根据你提供的截图，需要确认：

1. **"外部web服务器调用url"** - **必须为空** ✅
   - 如果填写了任何 URL，请清空

2. **"保存自动刷新浏览器(仅内置服务器)"** - 可以取消勾选
   - 这是 H5 预览的选项，小程序不需要

3. **"微信开发者工具路径"** - 已正确配置 ✅
   - `C:\Program Files (x86)\Tencent\微信web开发者工具\`

### 步骤 4：重新编译

1. **关闭所有微信开发者工具**
2. 在 HBuilderX 中：
   - 菜单：`运行` → `运行到小程序模拟器` → `微信开发者工具`
   - **不要选择** "运行到浏览器" 或 "运行到 H5"
3. 等待编译完成
4. 检查 `frontend/unpackage/dist/dev/mp-weixin/` 目录

### 步骤 5：验证修复成功

编译成功后，`unpackage/dist/dev/mp-weixin/` 目录应该包含：

- ✅ `app.json` - **必须存在！**
- ✅ `app.js`
- ✅ `app.wxss`
- ✅ `pages/` 目录
- ✅ `static/` 目录
- ❌ `index.html` - 不应该存在

---

## 📋 修复前后对比

### 修复前（错误）
```
unpackage/dist/dev/mp-weixin/
├── index.html          ❌ 这是 H5 产物
├── assets/
│   ├── index-xxx.js
│   └── index-xxx.css
```

### 修复后（正确）
```
unpackage/dist/dev/mp-weixin/
├── app.json           ✅ 小程序配置文件
├── app.js             ✅ 小程序入口
├── app.wxss           ✅ 小程序样式
├── pages/             ✅ 页面目录
│   ├── camp/
│   ├── home/
│   └── ...
└── static/            ✅ 静态资源
```

---

## 🔍 如果修复后仍无 app.json

### 检查 1：确认文件已重命名

检查 `frontend` 目录：
- ✅ `vite.config.ts.bak` 存在
- ✅ `index.html.bak` 存在
- ❌ `vite.config.ts` 不存在
- ❌ `index.html` 不存在

### 检查 2：确认运行目标

在 HBuilderX 中：
- ✅ 选择的是 "运行到小程序模拟器" → "微信开发者工具"
- ❌ 不是 "运行到浏览器" 或 "运行到 H5"

### 检查 3：查看编译日志

编译时查看 HBuilderX 控制台，应该看到：
- ✅ "正在编译中..."
- ✅ 不应该看到 "vite v5.x.x building"（这是 Vite 编译的标志）

### 检查 4：检查项目类型识别

在 HBuilderX 左侧项目树：
- ✅ 项目名称旁边应该显示 "uni-app" 标识
- ✅ 或者显示 "UniApp_Vue"

---

## 💡 为什么需要重命名这些文件？

1. **vite.config.ts**：
   - 这是 Vite 项目的配置文件
   - HBuilderX 检测到此文件会认为这是 Vite 项目
   - uni-app 项目不需要此文件（HBuilderX 会自动处理编译配置）

2. **index.html**：
   - 这是 Vite 项目的入口 HTML 文件
   - uni-app 会自动生成 `index.html`（如果需要）
   - 手动创建的 `index.html` 会让 HBuilderX 误判

3. **保留备份**：
   - 重命名为 `.bak` 而不是删除
   - 如果以后需要 H5 预览，可以恢复这些文件

---

## 🎯 完成修复后的操作

1. ✅ 文件已重命名
2. ✅ 清理了编译输出
3. ✅ 检查了运行设置
4. ✅ 重新编译
5. ✅ 验证生成了 `app.json`

如果所有步骤都完成，应该可以正常编译出小程序了！

