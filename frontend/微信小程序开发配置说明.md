# 微信小程序开发配置说明

## ✅ 已修复的问题

### 1. WXSS 编译错误：`unexpected token '*'`

**问题**：微信小程序 WXSS 不支持 `*` 选择器

**修复**：
- 将 `* { }` 改为 `page, view, text, button, input, textarea, image { }`
- 将 `body { }` 改为 `page { }`（微信小程序使用 `page` 作为根元素）
- 使用条件编译 `#ifdef H5` 保留 H5 环境的 `body` 和滚动条样式

**文件**：`frontend/styles/index.css`

---

## ⚠️ Socket 连接警告（可忽略）

### 警告信息
```
socket 合法域名校验出错
ws://192.168.1.128:8090 不在以下 socket 合法域名列表中
ws://127.0.0.1:8090 不在以下 socket 合法域名列表中
开发模式下日志通道建立 socket 连接失败
```

### 原因
这是 uni-app 开发模式下的日志通道连接，用于 HBuilderX 与微信开发者工具之间的通信。不影响小程序功能。

### 解决方法（可选）

#### 方法 1：在微信开发者工具中关闭域名校验（推荐）

1. 打开微信开发者工具
2. 点击右上角"详情"
3. 在"本地设置"中勾选：
   - ✅ **"不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书"**
   - ✅ **"不校验安全域名"**

#### 方法 2：在 manifest.json 中配置（已配置）

检查 `manifest.json` 中的 `mp-weixin.setting.urlCheck`：
```json
{
  "mp-weixin": {
    "setting": {
      "urlCheck": false  // ✅ 已设置为 false
    }
  }
}
```

---

## 📋 当前状态

### ✅ 已修复
1. ✅ `vite.config.ts` 已重命名
2. ✅ `index.html` 已删除
3. ✅ `main.ts` 已修复为 uni-app 规范
4. ✅ 所有 `Teleport` 已移除
5. ✅ 静态资源路径已修复（`/touxiang.png` → `/static/touxiang.png`）
6. ✅ WXSS `*` 选择器已修复

### ✅ 编译成功
- ✅ `app.json` 已生成
- ✅ `app.js` 已生成
- ✅ `app.wxss` 已生成
- ✅ `pages/` 目录已生成
- ✅ `static/` 目录已生成

---

## 🎯 下一步操作

### 1. 关闭域名校验（解决 Socket 警告）

在微信开发者工具中：
1. 点击右上角"详情"
2. 勾选"不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书"

### 2. 测试小程序功能

现在可以正常使用小程序了：
- ✅ 页面可以正常打开
- ✅ 路由跳转正常
- ✅ 组件正常渲染
- ✅ API 请求正常（需要配置后端地址）

### 3. 配置后端 API 地址

如果后端 API 不在合法域名列表中，需要：
1. 在微信公众平台配置服务器域名
2. 或在开发时关闭域名校验（方法1）

---

## 📝 注意事项

1. **Socket 警告不影响功能**：
   - 这只是开发模式的日志通道连接
   - 不影响小程序的实际功能
   - 可以安全忽略

2. **生产环境配置**：
   - 正式发布前需要在微信公众平台配置合法域名
   - 确保所有 API 请求都使用 HTTPS

3. **开发环境**：
   - 开发时可以关闭域名校验
   - 方便本地调试和测试

---

## 🎉 成功！

现在小程序应该可以正常运行了！如果还有其他问题，请查看：
- HBuilderX 控制台错误信息
- 微信开发者工具控制台错误信息
- 页面实际运行效果

