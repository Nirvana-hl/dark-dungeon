<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dungeon.mapper.StageMapper">
    
    <!-- 结果映射 -->
    <resultMap id="BaseResultMap" type="com.dungeon.entity.Stage">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="stage_number" property="stageNumber" jdbcType="INTEGER"/>
        <result column="chapter_number" property="chapterNumber" jdbcType="INTEGER"/>
        <result column="dungeon_id" property="dungeonId" jdbcType="BIGINT"/>
        <result column="stage_name" property="stageName" jdbcType="VARCHAR"/>
        <result column="difficulty" property="difficulty" jdbcType="VARCHAR"/>
        <result column="is_boss_stage" property="isBossStage" jdbcType="TINYINT"/>
        <result column="enemy_pool" property="enemyPool" jdbcType="VARCHAR"/>
        <result column="event_pool" property="eventPool" jdbcType="VARCHAR"/>
        <result column="reward_pool" property="rewardPool" jdbcType="VARCHAR"/>
        <result column="exploration_map" property="explorationMap" jdbcType="VARCHAR"/>
        <result column="description" property="description" jdbcType="VARCHAR"/>
    </resultMap>

    <!-- 基础列 -->
    <sql id="Base_Column_List">
        id, stage_number, chapter_number, dungeon_id, stage_name, difficulty, 
        is_boss_stage, enemy_pool, event_pool, reward_pool, exploration_map, description
    </sql>

    <!-- 根据关卡编号查询关卡 -->
    <select id="selectByStageNumber" resultMap="BaseResultMap">
        SELECT 
        <include refid="Base_Column_List"/>
        FROM stages
        WHERE stage_number = #{stageNumber}
    </select>

    <!-- 根据章节编号查询所有关卡 -->
    <select id="selectByChapterNumber" resultMap="BaseResultMap">
        SELECT 
        <include refid="Base_Column_List"/>
        FROM stages
        WHERE chapter_number = #{chapterNumber}
        ORDER BY stage_number ASC
    </select>

    <!-- 查询所有Boss关卡 -->
    <select id="selectBossStages" resultMap="BaseResultMap">
        SELECT 
        <include refid="Base_Column_List"/>
        FROM stages
        WHERE is_boss_stage = 1
        ORDER BY stage_number ASC
    </select>

    <!-- 根据难度查询关卡 -->
    <select id="selectByDifficulty" resultMap="BaseResultMap">
        SELECT 
        <include refid="Base_Column_List"/>
        FROM stages
        WHERE difficulty = #{difficulty}
        ORDER BY stage_number ASC
    </select>

</mapper>

