# Apifox æµ‹è¯•æŒ‡å— - åœ°ç‰¢æ¢ç´¢ä¸æˆ˜æ–—ç³»ç»Ÿ

> **æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
> **åˆ›å»ºæ—¥æœŸ**ï¼š2025-01-XX  
> **é€‚ç”¨èŒƒå›´**ï¼šæµ‹è¯•äººå‘˜ã€å¼€å‘äººå‘˜

---

## ğŸ“‹ ç›®å½•

1. [ç¯å¢ƒå‡†å¤‡](#ç¯å¢ƒå‡†å¤‡)
2. [å‰ç½®æ¡ä»¶](#å‰ç½®æ¡ä»¶)
3. [æµ‹è¯•æµç¨‹](#æµ‹è¯•æµç¨‹)
4. [æ¥å£è¯¦ç»†é…ç½®](#æ¥å£è¯¦ç»†é…ç½®)
5. [æµ‹è¯•æ•°æ®ç¤ºä¾‹](#æµ‹è¯•æ•°æ®ç¤ºä¾‹)
6. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ç¯å¢ƒå‡†å¤‡

### 1. åç«¯æœåŠ¡é…ç½®

**æœåŠ¡åœ°å€**ï¼š`http://localhost:8080`

**ç¡®è®¤åç«¯å·²å¯åŠ¨**ï¼š
- æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æ˜¾ç¤º "Started DungeonApplication"
- è®¿é—® `http://localhost:8080/h2-console` ç¡®è®¤æ•°æ®åº“è¿æ¥æ­£å¸¸

### 2. Apifox ç¯å¢ƒé…ç½®

**åˆ›å»ºç¯å¢ƒå˜é‡**ï¼š
1. æ‰“å¼€ Apifox
2. ç‚¹å‡»å·¦ä¾§ã€Œç¯å¢ƒç®¡ç†ã€
3. åˆ›å»ºæ–°ç¯å¢ƒã€Œæš—é»‘åœ°ç‰¢-æœ¬åœ°å¼€å‘ã€
4. é…ç½®å˜é‡ï¼š

| å˜é‡å | åˆå§‹å€¼ | è¯´æ˜ |
|--------|--------|------|
| `baseUrl` | `http://localhost:8080` | åç«¯æœåŠ¡åœ°å€ |
| `token` | ï¼ˆç©ºï¼‰ | JWT Tokenï¼Œç™»å½•åè‡ªåŠ¨è®¾ç½® |
| `userId` | ï¼ˆç©ºï¼‰ | ç”¨æˆ·IDï¼Œç™»å½•åè‡ªåŠ¨è®¾ç½® |
| `runId` | ï¼ˆç©ºï¼‰ | æ¢ç´¢è®°å½•IDï¼Œå¼€å§‹æ¢ç´¢åè‡ªåŠ¨è®¾ç½® |
| `stageNumber` | `1` | å…³å¡ç¼–å· |
| `userPlayerCharacterId` | ï¼ˆç©ºï¼‰ | ç©å®¶è§’è‰²å®ä¾‹ID |

---

## å‰ç½®æ¡ä»¶

### æ­¥éª¤1ï¼šç”¨æˆ·æ³¨å†Œ/ç™»å½•

#### 1.1 ç”¨æˆ·æ³¨å†Œï¼ˆå¯é€‰ï¼‰

**æ¥å£**ï¼š`POST {{baseUrl}}/auth/register`

**è¯·æ±‚å¤´**ï¼š
```
Content-Type: application/json
```

**è¯·æ±‚ä½“**ï¼š
```json
{
  "accountName": "testuser",
  "email": "test@example.com",
  "password": "123456"
}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 200,
  "message": "æ³¨å†ŒæˆåŠŸ",
  "data": {
    "userId": 1,
    "accountName": "testuser",
    "email": "test@example.com",
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }
}
```

**Apifox åç½®æ“ä½œ**ï¼ˆè‡ªåŠ¨ä¿å­˜ Tokenï¼‰ï¼š
1. åœ¨ã€Œåç½®æ“ä½œã€ä¸­æ·»åŠ ã€Œæå–å˜é‡ã€
2. å˜é‡åï¼š`token`
3. æå–è¡¨è¾¾å¼ï¼š`$.data.token`
4. å˜é‡åï¼š`userId`
5. æå–è¡¨è¾¾å¼ï¼š`$.data.userId`

#### 1.2 ç”¨æˆ·ç™»å½•

**æ¥å£**ï¼š`POST {{baseUrl}}/auth/login`

**è¯·æ±‚å¤´**ï¼š
```
Content-Type: application/json
```

**è¯·æ±‚ä½“**ï¼š
```json
{
  "email": "test@example.com",
  "password": "123456"
}
```

**æˆ–è€…ä½¿ç”¨è´¦å·åç§°ç™»å½•**ï¼š
```json
{
  "accountName": "testuser",
  "password": "123456"
}
```

**å“åº”ç¤ºä¾‹**ï¼šåŒæ³¨å†Œæ¥å£

**Apifox åç½®æ“ä½œ**ï¼šåŒæ³¨å†Œæ¥å£ï¼Œè‡ªåŠ¨ä¿å­˜ Token å’Œ userId

---

### æ­¥éª¤2ï¼šåˆ›å»ºç©å®¶è§’è‰²ï¼ˆå¯é€‰ï¼‰

**æ¥å£**ï¼š`POST {{baseUrl}}/user-player-characters`

**è¯·æ±‚å¤´**ï¼š
```
Authorization: Bearer {{token}}
Content-Type: application/json
```

**è¯·æ±‚ä½“**ï¼š
```json
{
  "playerCharacterId": 1
}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 200,
  "message": "åˆ›å»ºæˆåŠŸ",
  "data": {
    "id": 1,
    "userId": 1,
    "playerCharacterId": 1,
    "maxHp": 100,
    "currentHp": 100,
    "maxActionPoints": 3,
    "currentActionPoints": 3,
    "currentStress": 0
  }
}
```

**Apifox åç½®æ“ä½œ**ï¼š
- å˜é‡åï¼š`userPlayerCharacterId`
- æå–è¡¨è¾¾å¼ï¼š`$.data.id`

---

### æ­¥éª¤3ï¼šåˆå§‹åŒ–å…³å¡è¿›åº¦ï¼ˆå¯é€‰ï¼‰

å¦‚æœæ•°æ®åº“ä¸­æ²¡æœ‰å…³å¡è¿›åº¦æ•°æ®ï¼Œéœ€è¦å…ˆåˆå§‹åŒ–ï¼š

**æ–¹æ³•1ï¼šé€šè¿‡æ•°æ®åº“ç›´æ¥æ’å…¥**
```sql
INSERT INTO user_stage_progress (user_id, stage_number, chapter_number, is_unlocked, is_passed)
VALUES (1, 1, 1, 1, 0);
```

**æ–¹æ³•2ï¼šé€šè¿‡åç«¯æ¥å£**ï¼ˆå¦‚æœæœ‰ç›¸å…³æ¥å£ï¼‰

---

## æµ‹è¯•æµç¨‹

### å®Œæ•´æµ‹è¯•æµç¨‹æ¦‚è§ˆ

```
1. ç™»å½•è·å– Token
   â†“
2. è·å–åœ°ç‰¢åˆ—è¡¨ï¼ˆå¯é€‰ï¼‰
   â†“
3. å¼€å§‹æ¢ç´¢
   â†“
4. è·å–å½“å‰æ¢ç´¢ï¼ˆéªŒè¯ï¼‰
   â†“
5. æ¢ç´¢æˆ¿é—´ï¼ˆå¯èƒ½è§¦å‘äº‹ä»¶æˆ–é­é‡æ•Œäººï¼‰
   â†“
6. å¦‚æœé­é‡æ•Œäºº â†’ æˆ˜æ–—ç»“ç®—
   â†“
7. ç»§ç»­æ¢ç´¢æˆ–ç»“æŸæ¢ç´¢
```

---

## æ¥å£è¯¦ç»†é…ç½®

### æ¥å£1ï¼šè·å–åœ°ç‰¢åˆ—è¡¨

**åŸºæœ¬ä¿¡æ¯**ï¼š
- **æ–¹æ³•**ï¼š`GET`
- **è·¯å¾„**ï¼š`{{baseUrl}}/dungeons`
- **è®¤è¯**ï¼šæ— éœ€è®¤è¯

**è¯·æ±‚å¤´**ï¼š
```
Content-Type: application/json
```

**è¯·æ±‚å‚æ•°**ï¼šæ— 

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": [
    {
      "id": 1,
      "name": "æš—é»‘æ£®æ—",
      "difficulty": "easy",
      "theme": "forest",
      "description": "å……æ»¡å±é™©çš„æš—é»‘æ£®æ—"
    }
  ]
}
```

---

### æ¥å£2ï¼šå¼€å§‹æ¢ç´¢

**åŸºæœ¬ä¿¡æ¯**ï¼š
- **æ–¹æ³•**ï¼š`POST`
- **è·¯å¾„**ï¼š`{{baseUrl}}/dungeons/runs/start`
- **è®¤è¯**ï¼šéœ€è¦ Token

**è¯·æ±‚å¤´**ï¼š
```
Authorization: Bearer {{token}}
Content-Type: application/json
```

**è¯·æ±‚ä½“**ï¼š
```json
{
  "stageNumber": 1,
  "userPlayerCharacterId": 1,
  "cardCharacterIds": [1, 2],
  "cardIds": [10, 11],
  "consumableItemIds": [5],
  "notes": "æµ‹è¯•æ¢ç´¢"
}
```

**å­—æ®µè¯´æ˜**ï¼š
- `stageNumber`ï¼šå…³å¡ç¼–å·ï¼ˆå¿…å¡«ï¼‰
- `userPlayerCharacterId`ï¼šç©å®¶è§’è‰²å®ä¾‹IDï¼ˆå¿…å¡«ï¼‰
- `cardCharacterIds`ï¼šæºå¸¦çš„å¡ç‰Œè§’è‰²IDåˆ—è¡¨ï¼ˆå¯é€‰ï¼‰
- `cardIds`ï¼šæºå¸¦çš„æ³•æœ¯/è£…å¤‡å¡IDåˆ—è¡¨ï¼ˆå¯é€‰ï¼‰
- `consumableItemIds`ï¼šæºå¸¦çš„æ¶ˆè€—å“IDåˆ—è¡¨ï¼ˆå¯é€‰ï¼‰
- `notes`ï¼šå¤‡æ³¨ï¼ˆå¯é€‰ï¼‰

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 200,
  "message": "æ¢ç´¢å·²å¼€å¯",
  "data": {
    "id": 1,
    "stageNumber": 1,
    "chapterNumber": 1,
    "stageName": "ç¬¬1å…³",
    "difficulty": "easy",
    "result": null,
    "startedAt": "2025-01-XX 10:00:00",
    "progress": {
      "status": "exploring",
      "currentRoom": "Entrance",
      "exploredRooms": 0,
      "defeatedEnemies": 0,
      "eventLog": [],
      "battleLog": []
    }
  }
}
```

**Apifox åç½®æ“ä½œ**ï¼š
- å˜é‡åï¼š`runId`
- æå–è¡¨è¾¾å¼ï¼š`$.data.id`

---

### æ¥å£3ï¼šè·å–å…³å¡åœ°å›¾é…ç½®ï¼ˆæ–°å¢ï¼‰

**åŸºæœ¬ä¿¡æ¯**ï¼š
- **æ–¹æ³•**ï¼š`GET`
- **è·¯å¾„**ï¼š`{{baseUrl}}/stages/{{stageNumber}}/map`
- **è®¤è¯**ï¼šæ— éœ€è®¤è¯

**è¯·æ±‚å¤´**ï¼š
```
Content-Type: application/json
```

**è·¯å¾„å‚æ•°**ï¼š
- `stageNumber`ï¼šå…³å¡ç¼–å·ï¼ˆä¾‹å¦‚ï¼š1ï¼‰

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "stageNumber": 1,
    "stageName": "åˆå§‹åœ°ç‰¢",
    "map": {
      "rooms": [
        {
          "id": 1,
          "type": "start",
          "name": "å…¥å£",
          "x": 0,
          "y": 0,
          "description": "åœ°ç‰¢çš„å…¥å£ï¼Œä»è¿™é‡Œå¼€å§‹æ¢ç´¢"
        },
        {
          "id": 2,
          "type": "normal",
          "name": "èµ°å»Š",
          "x": 100,
          "y": 0,
          "description": "ä¸€æ¡é˜´æš—çš„èµ°å»Š"
        },
        {
          "id": 3,
          "type": "event",
          "name": "ç¥ç§˜æˆ¿é—´",
          "x": 200,
          "y": 0,
          "description": "è¿™é‡Œå¯èƒ½è§¦å‘éšæœºäº‹ä»¶"
        },
        {
          "id": 4,
          "type": "end",
          "name": "å‡ºå£",
          "x": 300,
          "y": 0,
          "description": "å®Œæˆå…³å¡"
        }
      ],
      "paths": [
        {"from": 1, "to": 2},
        {"from": 2, "to": 3},
        {"from": 3, "to": 4}
      ],
      "layout": "linear"
    }
  }
}
```

**å­—æ®µè¯´æ˜**ï¼š
- `rooms`ï¼šæˆ¿é—´åˆ—è¡¨
  - `id`ï¼šæˆ¿é—´ID
  - `type`ï¼šæˆ¿é—´ç±»å‹ï¼ˆstart/normal/event/boss/endï¼‰
  - `name`ï¼šæˆ¿é—´åç§°
  - `x`ã€`y`ï¼šæˆ¿é—´åæ ‡ï¼ˆå¯é€‰ï¼Œå‰ç«¯å¯è‡ªåŠ¨è®¡ç®—ï¼‰
  - `description`ï¼šæˆ¿é—´æè¿°
- `paths`ï¼šè·¯å¾„åˆ—è¡¨
  - `from`ï¼šèµ·å§‹æˆ¿é—´ID
  - `to`ï¼šç›®æ ‡æˆ¿é—´ID
- `layout`ï¼šå¸ƒå±€ç±»å‹ï¼ˆå¯é€‰ï¼‰

**ç”¨é€”**ï¼šè·å–å…³å¡åœ°å›¾é…ç½®ï¼Œç”¨äºå‰ç«¯æ¸²æŸ“åœ°å›¾å’Œè·¯å¾„

---

### æ¥å£4ï¼šè·å–å½“å‰æ¢ç´¢

**åŸºæœ¬ä¿¡æ¯**ï¼š
- **æ–¹æ³•**ï¼š`GET`
- **è·¯å¾„**ï¼š`{{baseUrl}}/dungeons/runs/current`
- **è®¤è¯**ï¼šéœ€è¦ Token

**è¯·æ±‚å¤´**ï¼š
```
Authorization: Bearer {{token}}
```

**è¯·æ±‚å‚æ•°**ï¼šæ— 

**å“åº”ç¤ºä¾‹**ï¼šåŒã€Œå¼€å§‹æ¢ç´¢ã€æ¥å£

**ç”¨é€”**ï¼šéªŒè¯æ¢ç´¢æ˜¯å¦å·²åˆ›å»ºï¼Œè·å–æœ€æ–°çŠ¶æ€

---

### æ¥å£5ï¼šè·å–æ¢ç´¢è¯¦æƒ…

**åŸºæœ¬ä¿¡æ¯**ï¼š
- **æ–¹æ³•**ï¼š`GET`
- **è·¯å¾„**ï¼š`{{baseUrl}}/dungeons/runs/{{runId}}`
- **è®¤è¯**ï¼šéœ€è¦ Token

**è¯·æ±‚å¤´**ï¼š
```
Authorization: Bearer {{token}}
```

**è·¯å¾„å‚æ•°**ï¼š
- `runId`ï¼šæ¢ç´¢è®°å½•IDï¼ˆä½¿ç”¨ç¯å¢ƒå˜é‡ `{{runId}}`ï¼‰

**å“åº”ç¤ºä¾‹**ï¼šåŒã€Œå¼€å§‹æ¢ç´¢ã€æ¥å£

---

### æ¥å£5ï¼šæ¢ç´¢æˆ¿é—´ï¼ˆæ ¸å¿ƒæ¥å£ï¼Œå·²å¢å¼ºæ”¯æŒåœ°å›¾æ¢ç´¢ï¼‰

**åŸºæœ¬ä¿¡æ¯**ï¼š
- **æ–¹æ³•**ï¼š`POST`
- **è·¯å¾„**ï¼š`{{baseUrl}}/dungeons/runs/{{runId}}/explore`
- **è®¤è¯**ï¼šéœ€è¦ Token

**è¯·æ±‚å¤´**ï¼š
```
Authorization: Bearer {{token}}
Content-Type: application/json
```

**è·¯å¾„å‚æ•°**ï¼š
- `runId`ï¼šæ¢ç´¢è®°å½•IDï¼ˆä½¿ç”¨ç¯å¢ƒå˜é‡ `{{runId}}`ï¼‰

**è¯·æ±‚ä½“ï¼ˆæ—§ç‰ˆçº¿æ€§æ¢ç´¢ï¼‰**ï¼š
```json
{
  "action": "explore"
}
```

**è¯·æ±‚ä½“ï¼ˆæ–°ç‰ˆåœ°å›¾æ¢ç´¢ï¼‰**ï¼š
```json
{
  "action": "move",
  "targetRoomId": 2
}
```

**å­—æ®µè¯´æ˜**ï¼š
- `action`ï¼šæ“ä½œç±»å‹
  - `"explore"`ï¼šæ™®é€šæ¢ç´¢ï¼ˆé»˜è®¤ï¼Œå…¼å®¹æ—§ç‰ˆçº¿æ€§æ¢ç´¢ï¼‰
  - `"move"`ï¼šç§»åŠ¨åˆ°æŒ‡å®šæˆ¿é—´ï¼ˆæ–°ç‰ˆåœ°å›¾æ¢ç´¢ï¼Œéœ€è¦æŒ‡å®štargetRoomIdï¼‰
  - `"event"`ï¼šä¸»åŠ¨è§¦å‘äº‹ä»¶
- `targetRoomId`ï¼šç›®æ ‡æˆ¿é—´IDï¼ˆæ–°ç‰ˆåœ°å›¾æ¢ç´¢æ—¶å¿…å¡«ï¼Œå¿…é¡»æ˜¯å¯è¾¾çš„æˆ¿é—´ï¼‰
- `choice`ï¼šé€‰æ‹©é¡¹ï¼ˆäº‹ä»¶é€‰æ‹©æ—¶ä½¿ç”¨ï¼Œå¯é€‰ï¼‰

**å“åº”ç¤ºä¾‹ï¼ˆé­é‡æ•Œäººï¼‰**ï¼š
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "run": {
      "id": 1,
      "progress": {
        "status": "awaiting_battle",
        "exploredRooms": 1,
        "pendingEnemyName": "éª·é«…æˆ˜å£«",
        "pendingEnemyDifficulty": "normal"
      }
    },
    "message": "é­é‡æ•Œäººï¼šéª·é«…æˆ˜å£«",
    "battlePending": true,
    "eventSummary": null
  }
}
```

**å“åº”ç¤ºä¾‹ï¼ˆè§¦å‘äº‹ä»¶ï¼‰**ï¼š
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "run": {
      "id": 1,
      "progress": {
        "status": "exploring",
        "currentRoom": "ç¥ç§˜æˆ¿é—´",
        "currentRoomId": 3,
        "visitedRooms": [1, 2, 3],
        "exploredRooms": 2
      }
    },
    "message": "è§¦å‘äº‹ä»¶ï¼šç¥ç§˜å®ç®±",
    "battlePending": false,
    "eventSummary": "ç¥ç§˜å®ç®±ï¼šä½ å‘ç°äº†ä¸€ä¸ªå®ç®±ï¼Œè·å¾— 50 é‡‘å¸ã€‚"
  }
}
```

**å“åº”ç¤ºä¾‹ï¼ˆåœ°å›¾æ¢ç´¢ - ç§»åŠ¨åˆ°æˆ¿é—´ï¼‰**ï¼š
```json
{
  "code": 200,
  "message": "ç§»åŠ¨åˆ°æˆ¿é—´ï¼šèµ°å»Š",
  "data": {
    "run": {
      "id": 1,
      "progress": {
        "status": "exploring",
        "currentRoom": "èµ°å»Š",
        "currentRoomId": 2,
        "visitedRooms": [1, 2],
        "exploredRooms": 1
      }
    },
    "message": "ç§»åŠ¨åˆ°æˆ¿é—´ï¼šèµ°å»Š",
    "battlePending": false,
    "eventSummary": null
  }
}
```

**æˆ¿é—´ç±»å‹è¯´æ˜**ï¼š
- `start`ï¼šå…¥å£æˆ¿é—´ï¼Œä¸è§¦å‘ä»»ä½•å†…å®¹
- `normal`ï¼šæ™®é€šæˆ¿é—´ï¼Œéšæœºè§¦å‘äº‹ä»¶æˆ–æ•Œäººï¼ˆ50%æ¦‚ç‡ï¼‰
- `event`ï¼šäº‹ä»¶æˆ¿é—´ï¼Œå¿…å®šè§¦å‘äº‹ä»¶
- `boss`ï¼šBossæˆ¿é—´ï¼Œå¿…å®šè§¦å‘Bossæˆ˜æ–—
- `end`ï¼šå‡ºå£æˆ¿é—´ï¼Œåˆ°è¾¾åè‡ªåŠ¨å®Œæˆæ¢ç´¢ï¼ˆstatuså˜ä¸º"completed"ï¼‰

**æµ‹è¯•å»ºè®®**ï¼š
- **åœ°å›¾æ¢ç´¢**ï¼šå…ˆè°ƒç”¨ã€Œè·å–å…³å¡åœ°å›¾é…ç½®ã€æ¥å£ï¼Œäº†è§£æˆ¿é—´å’Œè·¯å¾„ï¼Œç„¶åä½¿ç”¨ `action: "move"` å’Œ `targetRoomId` è¿›è¡Œç§»åŠ¨
- **çº¿æ€§æ¢ç´¢**ï¼šä½¿ç”¨ `action: "explore"` è¿›è¡Œæ—§ç‰ˆçº¿æ€§æ¢ç´¢ï¼ˆå‘åå…¼å®¹ï¼‰
- å¤šæ¬¡è°ƒç”¨æ­¤æ¥å£ï¼Œè§‚å¯Ÿæ˜¯å¦éšæœºè§¦å‘äº‹ä»¶æˆ–é­é‡æ•Œäºº
- å½“ `battlePending = true` æ—¶ï¼Œéœ€è¦è°ƒç”¨æˆ˜æ–—ç»“ç®—æ¥å£
- æ£€æŸ¥å“åº”ä¸­çš„ `currentRoomId` å’Œ `visitedRooms` ç¡®è®¤æ¢ç´¢è¿›åº¦

---

### æ¥å£6ï¼šæˆ˜æ–—ç»“ç®—ï¼ˆæ ¸å¿ƒæ¥å£ï¼‰

**åŸºæœ¬ä¿¡æ¯**ï¼š
- **æ–¹æ³•**ï¼š`POST`
- **è·¯å¾„**ï¼š`{{baseUrl}}/dungeons/runs/{{runId}}/battle`
- **è®¤è¯**ï¼šéœ€è¦ Token

**è¯·æ±‚å¤´**ï¼š
```
Authorization: Bearer {{token}}
Content-Type: application/json
```

**è·¯å¾„å‚æ•°**ï¼š
- `runId`ï¼šæ¢ç´¢è®°å½•IDï¼ˆä½¿ç”¨ç¯å¢ƒå˜é‡ `{{runId}}`ï¼‰

**è¯·æ±‚ä½“**ï¼ˆå¯é€‰ï¼‰ï¼š
```json
{
  "strategy": "aggressive"
}
```

**å­—æ®µè¯´æ˜**ï¼š
- `strategy`ï¼šæˆ˜æ–—ç­–ç•¥ï¼ˆå¯é€‰ï¼‰
  - `"aggressive"`ï¼šæ¿€è¿›ç­–ç•¥ï¼ˆæ”»å‡»åŠ›+5ï¼Œè¡€é‡-5ï¼‰
  - `"defensive"`ï¼šé˜²å¾¡ç­–ç•¥ï¼ˆæ•Œäººæ”»å‡»åŠ›-2ï¼‰
  - `null` æˆ–ä¸ä¼ ï¼šé»˜è®¤ç­–ç•¥

**å“åº”ç¤ºä¾‹ï¼ˆèƒœåˆ©ï¼‰**ï¼š
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "run": {
      "id": 1,
      "progress": {
        "status": "exploring",
        "defeatedEnemies": 1,
        "battleLog": [
          "ç¬¬1å›åˆï¼šç©å®¶é€ æˆ 12 ç‚¹ä¼¤å®³ã€‚æ•Œäººå‰©ä½™ 68 HPã€‚",
          "ç¬¬1å›åˆï¼šæ•Œäººé€ æˆ 8 ç‚¹ä¼¤å®³ã€‚ç©å®¶å‰©ä½™ 92 HPã€‚",
          "ç¬¬2å›åˆï¼šç©å®¶é€ æˆ 15 ç‚¹ä¼¤å®³ã€‚æ•Œäººå‰©ä½™ 53 HPã€‚",
          "..."
        ]
      }
    },
    "message": "æˆ˜æ–—å·²ç»“ç®—ï¼Œç»“æœï¼švictory",
    "battleResult": {
      "outcome": "victory",
      "enemyName": "éª·é«…æˆ˜å£«",
      "heroRemainingHp": 65,
      "enemyRemainingHp": 0,
      "battleLog": [
        "ç¬¬1å›åˆï¼šç©å®¶é€ æˆ 12 ç‚¹ä¼¤å®³ã€‚æ•Œäººå‰©ä½™ 68 HPã€‚",
        "ç¬¬1å›åˆï¼šæ•Œäººé€ æˆ 8 ç‚¹ä¼¤å®³ã€‚ç©å®¶å‰©ä½™ 92 HPã€‚",
        "..."
      ]
    },
    "battlePending": false
  }
}
```

**å“åº”ç¤ºä¾‹ï¼ˆå¤±è´¥ï¼‰**ï¼š
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "run": {
      "id": 1,
      "result": "defeat",
      "endedAt": "2025-01-XX 10:05:00",
      "progress": {
        "status": "completed"
      }
    },
    "message": "æˆ˜æ–—å·²ç»“ç®—ï¼Œç»“æœï¼šdefeat",
    "battleResult": {
      "outcome": "defeat",
      "enemyName": "éª·é«…æˆ˜å£«",
      "heroRemainingHp": 0,
      "enemyRemainingHp": 45,
      "battleLog": [...]
    },
    "battlePending": false
  }
}
```

**æµ‹è¯•å»ºè®®**ï¼š
- æµ‹è¯•ä¸åŒç­–ç•¥å¯¹æˆ˜æ–—ç»“æœçš„å½±å“
- éªŒè¯æˆ˜æ–—åè§’è‰²è¡€é‡æ˜¯å¦æ­£ç¡®æ›´æ–°
- éªŒè¯æˆ˜æ–—å¤±è´¥åæ¢ç´¢æ˜¯å¦è‡ªåŠ¨ç»“æŸ

---

### æ¥å£7ï¼šç»“æŸæ¢ç´¢

**åŸºæœ¬ä¿¡æ¯**ï¼š
- **æ–¹æ³•**ï¼š`POST`
- **è·¯å¾„**ï¼š`{{baseUrl}}/dungeons/runs/{{runId}}/end`
- **è®¤è¯**ï¼šéœ€è¦ Token

**è¯·æ±‚å¤´**ï¼š
```
Authorization: Bearer {{token}}
Content-Type: application/json
```

**è·¯å¾„å‚æ•°**ï¼š
- `runId`ï¼šæ¢ç´¢è®°å½•IDï¼ˆä½¿ç”¨ç¯å¢ƒå˜é‡ `{{runId}}`ï¼‰

**è¯·æ±‚ä½“**ï¼ˆå¯é€‰ï¼‰ï¼š
```json
{
  "result": "victory",
  "notes": "æµ‹è¯•å®Œæˆ",
  "rewardChoice": {
    "gold": 200,
    "experience": 100
  }
}
```

**å­—æ®µè¯´æ˜**ï¼š
- `result`ï¼šæ¢ç´¢ç»“æœï¼ˆå¯é€‰ï¼‰
  - `"victory"`ï¼šèƒœåˆ©
  - `"defeat"`ï¼šå¤±è´¥
  - `"abandon"`ï¼šæ”¾å¼ƒï¼ˆé»˜è®¤ï¼‰
- `notes`ï¼šå¤‡æ³¨ï¼ˆå¯é€‰ï¼‰
- `rewardChoice`ï¼šå¥–åŠ±é€‰æ‹©ï¼ˆå¯é€‰ï¼ŒJSONå¯¹è±¡ï¼‰

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 200,
  "message": "æ¢ç´¢å·²ç»“æŸ",
  "data": {
    "id": 1,
    "result": "victory",
    "endedAt": "2025-01-XX 10:10:00",
    "rewardSnapshot": "{\"gold\":200,\"experience\":100}"
  }
}
```

**æµ‹è¯•å»ºè®®**ï¼š
- æµ‹è¯•ä¸åŒç»“æœç±»å‹ï¼ˆvictory/defeat/abandonï¼‰
- éªŒè¯å¥–åŠ±æ˜¯å¦æ­£ç¡®è®°å½•
- éªŒè¯å…³å¡è¿›åº¦æ˜¯å¦æ­£ç¡®æ›´æ–°

---

## æµ‹è¯•æ•°æ®ç¤ºä¾‹

### å®Œæ•´æµ‹è¯•åœºæ™¯

#### åœºæ™¯1ï¼šå®Œæ•´æ¢ç´¢æµç¨‹ï¼ˆèƒœåˆ©ï¼‰

1. **ç™»å½•**
   ```json
   {
     "email": "test@example.com",
     "password": "123456"
   }
   ```

2. **å¼€å§‹æ¢ç´¢**
   ```json
   {
     "stageNumber": 1,
     "userPlayerCharacterId": 1,
     "cardCharacterIds": [1, 2],
     "cardIds": [10, 11]
   }
   ```

3. **æ¢ç´¢æˆ¿é—´**ï¼ˆé‡å¤å¤šæ¬¡ï¼Œç›´åˆ°é­é‡æ•Œäººï¼‰
   ```json
   {
     "action": "explore"
   }
   ```

4. **æˆ˜æ–—ç»“ç®—**ï¼ˆä½¿ç”¨æ¿€è¿›ç­–ç•¥ï¼‰
   ```json
   {
     "strategy": "aggressive"
   }
   ```

5. **ç»§ç»­æ¢ç´¢**ï¼ˆå¦‚æœæˆ˜æ–—èƒœåˆ©ï¼‰

6. **ç»“æŸæ¢ç´¢**ï¼ˆèƒœåˆ©ï¼‰
   ```json
   {
     "result": "victory",
     "rewardChoice": {
       "gold": 200,
       "experience": 100
     }
   }
   ```

#### åœºæ™¯2ï¼šæˆ˜æ–—å¤±è´¥æµç¨‹

1. **ç™»å½•**ï¼ˆåŒä¸Šï¼‰

2. **å¼€å§‹æ¢ç´¢**ï¼ˆåŒä¸Šï¼‰

3. **æ¢ç´¢æˆ¿é—´**ï¼ˆé­é‡æ•Œäººï¼‰

4. **æˆ˜æ–—ç»“ç®—**ï¼ˆå¯èƒ½å¤±è´¥ï¼‰
   ```json
   {
     "strategy": "defensive"
   }
   ```

5. **éªŒè¯**ï¼šå¦‚æœæˆ˜æ–—å¤±è´¥ï¼Œæ¢ç´¢åº”è‡ªåŠ¨ç»“æŸï¼ˆ`result = "defeat"`ï¼‰

---

## å¸¸è§é—®é¢˜

### Q1ï¼š401 æœªæˆæƒé”™è¯¯

**åŸå› **ï¼šToken æœªè®¾ç½®æˆ–å·²è¿‡æœŸ

**è§£å†³æ–¹æ³•**ï¼š
1. é‡æ–°è°ƒç”¨ç™»å½•æ¥å£è·å– Token
2. æ£€æŸ¥ Apifox ç¯å¢ƒå˜é‡ä¸­çš„ `token` æ˜¯å¦æ­£ç¡®è®¾ç½®
3. ç¡®è®¤è¯·æ±‚å¤´æ ¼å¼ï¼š`Authorization: Bearer {{token}}`

---

### Q2ï¼š400 é”™è¯¯ï¼šå…³å¡å°šæœªè§£é”

**åŸå› **ï¼šæ•°æ®åº“ä¸­æ²¡æœ‰å¯¹åº”çš„å…³å¡è¿›åº¦è®°å½•

**è§£å†³æ–¹æ³•**ï¼š
1. é€šè¿‡æ•°æ®åº“ç›´æ¥æ’å…¥ï¼š
   ```sql
   INSERT INTO user_stage_progress (user_id, stage_number, chapter_number, is_unlocked, is_passed)
   VALUES (1, 1, 1, 1, 0);
   ```
2. æˆ–è€…å…ˆé€šè¿‡ç¬¬1å…³ï¼Œè‡ªåŠ¨è§£é”åç»­å…³å¡

---

### Q3ï¼š400 é”™è¯¯ï¼šè§’è‰²ä¸å­˜åœ¨æˆ–ä¸å±äºå½“å‰ç”¨æˆ·

**åŸå› **ï¼š`userPlayerCharacterId` ä¸å­˜åœ¨æˆ–ä¸å±äºå½“å‰ç”¨æˆ·

**è§£å†³æ–¹æ³•**ï¼š
1. å…ˆè°ƒç”¨åˆ›å»ºè§’è‰²æ¥å£ï¼š`POST /user-player-characters`
2. æˆ–è€…æŸ¥è¯¢ç°æœ‰è§’è‰²ï¼š`GET /user-player-characters`
3. ä½¿ç”¨æ­£ç¡®çš„ `userPlayerCharacterId`

---

### Q4ï¼š400 é”™è¯¯ï¼šå½“å‰å·²æœ‰è¿›è¡Œä¸­çš„æ¢ç´¢

**åŸå› **ï¼šå­˜åœ¨æœªç»“æŸçš„æ¢ç´¢è®°å½•

**è§£å†³æ–¹æ³•**ï¼š
1. å…ˆè°ƒç”¨ç»“æŸæ¢ç´¢æ¥å£ï¼š`POST /dungeons/runs/{{runId}}/end`
2. æˆ–è€…é€šè¿‡æ•°æ®åº“åˆ é™¤æœªå®Œæˆçš„è®°å½•ï¼š
   ```sql
   UPDATE runs SET result = 'abandon' WHERE user_id = 1 AND result IS NULL;
   ```

---

### Q5ï¼š400 é”™è¯¯ï¼šå½“å‰æ²¡æœ‰å¾…å¤„ç†çš„æˆ˜æ–—

**åŸå› **ï¼šåœ¨æœªé­é‡æ•Œäººçš„æƒ…å†µä¸‹è°ƒç”¨æˆ˜æ–—ç»“ç®—æ¥å£

**è§£å†³æ–¹æ³•**ï¼š
1. å…ˆè°ƒç”¨æ¢ç´¢æˆ¿é—´æ¥å£ï¼Œç­‰å¾… `battlePending = true`
2. åªæœ‰åœ¨é­é‡æ•Œäººåæ‰èƒ½è°ƒç”¨æˆ˜æ–—ç»“ç®—æ¥å£

---

### Q6ï¼šå¦‚ä½•æŸ¥çœ‹æ•°æ®åº“ä¸­çš„æ¢ç´¢è®°å½•ï¼Ÿ

**æ–¹æ³•1ï¼šé€šè¿‡æ¥å£æŸ¥è¯¢**
- `GET /dungeons/runs/current` - è·å–å½“å‰æ¢ç´¢
- `GET /dungeons/runs/{{runId}}` - è·å–æ¢ç´¢è¯¦æƒ…

**æ–¹æ³•2ï¼šé€šè¿‡æ•°æ®åº“æŸ¥è¯¢**
```sql
-- æŸ¥çœ‹æ‰€æœ‰æ¢ç´¢è®°å½•
SELECT * FROM runs WHERE user_id = 1;

-- æŸ¥çœ‹æ¢ç´¢è¿›åº¦ï¼ˆJSONæ ¼å¼ï¼‰
SELECT id, current_stage_progress FROM runs WHERE id = 1;
```

---

### Q7ï¼šå¦‚ä½•é‡ç½®æµ‹è¯•æ•°æ®ï¼Ÿ

**æ–¹æ³•1ï¼šé€šè¿‡æ¥å£ç»“æŸæ¢ç´¢**
```json
POST /dungeons/runs/{{runId}}/end
{
  "result": "abandon"
}
```

**æ–¹æ³•2ï¼šé€šè¿‡æ•°æ®åº“åˆ é™¤**
```sql
-- åˆ é™¤æ¢ç´¢è®°å½•
DELETE FROM runs WHERE user_id = 1;

-- é‡ç½®è§’è‰²çŠ¶æ€
UPDATE user_player_characters 
SET current_hp = max_hp, current_stress = 0 
WHERE user_id = 1;

-- é‡ç½®å…³å¡è¿›åº¦
UPDATE user_stage_progress 
SET is_passed = 0, attempt_count = 0 
WHERE user_id = 1 AND stage_number = 1;
```

---

## Apifox æµ‹è¯•é›†åˆé…ç½®

### åˆ›å»ºæµ‹è¯•é›†åˆ

1. åœ¨ Apifox ä¸­åˆ›å»ºã€Œåœ°ç‰¢æ¢ç´¢ä¸æˆ˜æ–—ç³»ç»Ÿã€æµ‹è¯•é›†åˆ
2. æŒ‰ä»¥ä¸‹é¡ºåºæ·»åŠ æ¥å£ï¼š

```
1. ç”¨æˆ·ç™»å½•
   â†“
2. è·å–åœ°ç‰¢åˆ—è¡¨ï¼ˆå¯é€‰ï¼‰
   â†“
3. å¼€å§‹æ¢ç´¢
   â†“
4. è·å–å½“å‰æ¢ç´¢ï¼ˆéªŒè¯ï¼‰
   â†“
5. æ¢ç´¢æˆ¿é—´ï¼ˆå¾ªç¯3-5æ¬¡ï¼‰
   â†“
6. æˆ˜æ–—ç»“ç®—ï¼ˆå¦‚æœ battlePending = trueï¼‰
   â†“
7. ç»“æŸæ¢ç´¢
```

### é…ç½®è‡ªåŠ¨åŒ–æµ‹è¯•

**å‰ç½®è„šæœ¬**ï¼ˆåœ¨æµ‹è¯•é›†åˆçº§åˆ«ï¼‰ï¼š
```javascript
// ç¡®ä¿ token å·²è®¾ç½®
if (!pm.environment.get("token")) {
    console.log("è­¦å‘Šï¼šToken æœªè®¾ç½®ï¼Œè¯·å…ˆç™»å½•");
}
```

**åç½®è„šæœ¬**ï¼ˆåœ¨ã€Œå¼€å§‹æ¢ç´¢ã€æ¥å£ï¼‰ï¼š
```javascript
// è‡ªåŠ¨ä¿å­˜ runId
if (pm.response.json().data && pm.response.json().data.id) {
    pm.environment.set("runId", pm.response.json().data.id);
    console.log("å·²ä¿å­˜ runId: " + pm.response.json().data.id);
}
```

---

## æµ‹è¯•æ£€æŸ¥æ¸…å•

### åŠŸèƒ½æµ‹è¯•

- [ ] ç”¨æˆ·ç™»å½•æˆåŠŸï¼ŒToken æ­£ç¡®ä¿å­˜
- [ ] å¼€å§‹æ¢ç´¢æˆåŠŸï¼Œè¿”å›æ¢ç´¢è®°å½•ID
- [ ] æ¢ç´¢æˆ¿é—´å¯ä»¥è§¦å‘äº‹ä»¶æˆ–é­é‡æ•Œäºº
- [ ] æˆ˜æ–—ç»“ç®—æ­£ç¡®è®¡ç®—æˆ˜æ–—ç»“æœ
- [ ] æˆ˜æ–—èƒœåˆ©åå¯ä»¥ç»§ç»­æ¢ç´¢
- [ ] æˆ˜æ–—å¤±è´¥åæ¢ç´¢è‡ªåŠ¨ç»“æŸ
- [ ] ç»“æŸæ¢ç´¢æ­£ç¡®æ›´æ–°å…³å¡è¿›åº¦
- [ ] è§’è‰²çŠ¶æ€ï¼ˆè¡€é‡ã€å‹åŠ›ï¼‰æ­£ç¡®æ›´æ–°

### è¾¹ç•Œæµ‹è¯•

- [ ] æœªç™»å½•æ—¶è°ƒç”¨æ¥å£è¿”å› 401
- [ ] å…³å¡æœªè§£é”æ—¶è¿”å› 400
- [ ] æ— å¾…å¤„ç†æˆ˜æ–—æ—¶è°ƒç”¨æˆ˜æ–—æ¥å£è¿”å› 400
- [ ] å·²æœ‰è¿›è¡Œä¸­æ¢ç´¢æ—¶å†æ¬¡å¼€å§‹æ¢ç´¢è¿”å› 400
- [ ] æˆ˜æ–—ç­–ç•¥å‚æ•°æµ‹è¯•ï¼ˆaggressive/defensive/nullï¼‰

### æ•°æ®éªŒè¯

- [ ] æ¢ç´¢è¿›åº¦ JSON æ ¼å¼æ­£ç¡®
- [ ] æˆ˜æ–—æ—¥å¿—åŒ…å«å®Œæ•´å›åˆä¿¡æ¯
- [ ] è§’è‰²è¡€é‡æ›´æ–°æ­£ç¡®
- [ ] å‹åŠ›å€¼ç´¯ç§¯æ­£ç¡®ï¼ˆ+3ï¼‰
- [ ] å‡»è´¥æ•Œäººæ•°ç»Ÿè®¡æ­£ç¡®

---

## æ€»ç»“

é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œä½ å¯ä»¥åœ¨ Apifox ä¸­å®Œæ•´æµ‹è¯•åœ°ç‰¢æ¢ç´¢ä¸æˆ˜æ–—ç³»ç»Ÿçš„æ‰€æœ‰åŠŸèƒ½ã€‚å»ºè®®æŒ‰ç…§æµ‹è¯•æµç¨‹é¡ºåºæ‰§è¡Œï¼Œå¹¶æ³¨æ„ä¿å­˜ç¯å¢ƒå˜é‡ï¼ˆtokenã€runIdç­‰ï¼‰ï¼Œä»¥ä¾¿åç»­æ¥å£è°ƒç”¨ã€‚

**å…³é”®æç¤º**ï¼š
1. æ‰€æœ‰éœ€è¦è®¤è¯çš„æ¥å£éƒ½è¦åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ  `Authorization: Bearer {{token}}`
2. ä½¿ç”¨ç¯å¢ƒå˜é‡ `{{runId}}` æ¥å¼•ç”¨æ¢ç´¢è®°å½•ID
3. æˆ˜æ–—ç»“ç®—å‰å¿…é¡»å…ˆé€šè¿‡æ¢ç´¢æˆ¿é—´é­é‡æ•Œäºº
4. æµ‹è¯•å®Œæˆåè®°å¾—ç»“æŸæ¢ç´¢ï¼Œé¿å…å½±å“åç»­æµ‹è¯•

---

**æ–‡æ¡£ç»´æŠ¤**ï¼šæœ¬æ–‡æ¡£ä¼šéšç€æ¥å£çš„æ›´æ–°æŒç»­ç»´æŠ¤ã€‚

