# æŠ€èƒ½ç³»ç»Ÿè®¾è®¡åˆ†æ

## ğŸ” é—®é¢˜åˆ†æ

### å½“å‰è®¾è®¡
```
user_player_characters (è§’è‰²å®ä¾‹è¡¨)
â”œâ”€ id = 3 (è§’è‰²å®ä¾‹ID)
â”œâ”€ user_id = 1 (ç”¨æˆ·ID)
â””â”€ player_character_id = 1 (èŒä¸šæ¨¡æ¿IDï¼Œå¦‚æˆ˜å£«)

user_player_character_skills (æŠ€èƒ½è§£é”è®°å½•è¡¨)
â”œâ”€ user_player_character_id = 3 â† å…³è”åˆ°è§’è‰²å®ä¾‹ID
â””â”€ skill_id = 10 (æŠ€èƒ½æ¨¡æ¿ID)
```

### å­˜åœ¨çš„é—®é¢˜

1. **ä»£ç é”™è¯¯ï¼ˆå·²ä¿®å¤ï¼‰**
   - åŸä»£ç ä½¿ç”¨äº† `userCharacter.getPlayerCharacterId()`ï¼ˆè§’è‰²æ¨¡æ¿IDï¼‰
   - åº”è¯¥ä½¿ç”¨ `userCharacter.getId()`ï¼ˆè§’è‰²å®ä¾‹IDï¼‰

2. **è®¾è®¡é—®é¢˜**
   - æŠ€èƒ½è§£é”å…³è”åˆ°**è§’è‰²å®ä¾‹ID**ï¼Œè€Œä¸æ˜¯**ç”¨æˆ·+èŒä¸š**çš„ç»„åˆ
   - å¦‚æœç”¨æˆ·åˆ é™¤è§’è‰²å®ä¾‹å¹¶é‡æ–°åˆ›å»ºï¼ŒæŠ€èƒ½è§£é”è®°å½•ä¼šä¸¢å¤±
   - æŠ€èƒ½è§£é”åº”è¯¥æ˜¯ç”¨æˆ·å¯¹èŒä¸šçš„**æ°¸ä¹…æŠ•èµ„**ï¼Œä¸åº”è¯¥å› ä¸ºè§’è‰²å®ä¾‹çš„åˆ é™¤è€Œä¸¢å¤±

## ğŸ’¡ ä¼˜åŒ–æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šä¿æŒå½“å‰è®¾è®¡ï¼ˆç®€å•ä¿®å¤ï¼‰

**ä¼˜ç‚¹ï¼š**
- ä¿®æ”¹æœ€å°ï¼Œåªéœ€ä¿®å¤ä»£ç é”™è¯¯
- ç”±äº `user_player_characters` è¡¨æœ‰å”¯ä¸€çº¦æŸ `(user_id, player_character_id)`ï¼Œä¸€ä¸ªç”¨æˆ·åªèƒ½æœ‰ä¸€ä¸ªç‰¹å®šèŒä¸šçš„å®ä¾‹
- é€»è¾‘ä¸Šå¯ä»¥å·¥ä½œï¼Œåªè¦ç¡®ä¿ä¸ä¼šåˆ é™¤é‡å»ºè§’è‰²

**ç¼ºç‚¹ï¼š**
- å¦‚æœå°†æ¥å…è®¸åˆ é™¤é‡å»ºè§’è‰²ï¼ŒæŠ€èƒ½è§£é”ä¼šä¸¢å¤±
- è®¾è®¡ä¸Šä¸å¤Ÿå¥å£®

### æ–¹æ¡ˆ2ï¼šä¿®æ”¹è¡¨ç»“æ„ï¼ˆæ¨èï¼‰

**ä¿®æ”¹ `user_player_character_skills` è¡¨ï¼š**
```sql
ALTER TABLE user_player_character_skills
ADD COLUMN user_id BIGINT NOT NULL AFTER id,
ADD COLUMN player_character_id BIGINT NOT NULL AFTER user_id,
ADD INDEX idx_user_character (user_id, player_character_id);

-- è¿ç§»ç°æœ‰æ•°æ®
UPDATE user_player_character_skills upcs
INNER JOIN user_player_characters upc ON upcs.user_player_character_id = upc.id
SET upcs.user_id = upc.user_id,
    upcs.player_character_id = upc.player_character_id;

-- å¯é€‰ï¼šä¿ç•™ user_player_character_id ä½œä¸ºå†—ä½™å­—æ®µï¼Œæˆ–åˆ é™¤å®ƒ
-- å¦‚æœä¿ç•™ï¼Œå¯ä»¥ç”¨äºå¿«é€ŸæŸ¥è¯¢ï¼›å¦‚æœåˆ é™¤ï¼Œéœ€è¦ä¿®æ”¹æ‰€æœ‰æŸ¥è¯¢é€»è¾‘
```

**ä¼˜ç‚¹ï¼š**
- æŠ€èƒ½è§£é”å…³è”åˆ°"ç”¨æˆ·+èŒä¸š"ï¼Œè€Œä¸æ˜¯è§’è‰²å®ä¾‹
- å³ä½¿åˆ é™¤é‡å»ºè§’è‰²ï¼ŒæŠ€èƒ½è§£é”ä¹Ÿä¸ä¼šä¸¢å¤±
- æ›´ç¬¦åˆä¸šåŠ¡é€»è¾‘ï¼šæŠ€èƒ½è§£é”æ˜¯ç”¨æˆ·å¯¹èŒä¸šçš„æŠ•èµ„

**ç¼ºç‚¹ï¼š**
- éœ€è¦ä¿®æ”¹è¡¨ç»“æ„å’Œæ‰€æœ‰ç›¸å…³ä»£ç 
- éœ€è¦æ•°æ®è¿ç§»

## ğŸ¯ æ¨èæ–¹æ¡ˆ

**å»ºè®®é‡‡ç”¨æ–¹æ¡ˆ2**ï¼ŒåŸå› ï¼š
1. æŠ€èƒ½è§£é”æ˜¯ç”¨æˆ·å¯¹èŒä¸šçš„æ°¸ä¹…æŠ•èµ„ï¼Œåº”è¯¥æŒä¹…åŒ–
2. å³ä½¿å½“å‰ä¸å…è®¸åˆ é™¤è§’è‰²ï¼Œå°†æ¥å¯èƒ½ä¼šæ”¯æŒ
3. è®¾è®¡æ›´å¥å£®ï¼Œç¬¦åˆä¸šåŠ¡é€»è¾‘

## ğŸ“ å®æ–½æ­¥éª¤

å¦‚æœé‡‡ç”¨æ–¹æ¡ˆ2ï¼Œéœ€è¦ï¼š

1. **ä¿®æ”¹è¡¨ç»“æ„**ï¼ˆè§ä¸Šé¢çš„SQLï¼‰
2. **ä¿®æ”¹å®ä½“ç±»**ï¼Œå¢åŠ  `userId` å’Œ `playerCharacterId` å­—æ®µ
3. **ä¿®æ”¹Serviceé€»è¾‘**ï¼š
   - `getUserUnlockedSkills()`: ä½¿ç”¨ `(user_id, player_character_id)` æŸ¥è¯¢
   - `unlockSkill()`: æ’å…¥æ—¶åŒæ—¶è®¾ç½® `user_id` å’Œ `player_character_id`
   - `getSkillTreeByPlayerCharacterCode()`: éœ€è¦å…ˆæ ¹æ® `player_character_code` æ‰¾åˆ° `player_character_id`ï¼Œç„¶åæŸ¥è¯¢

## ğŸ”„ å½“å‰ä¿®å¤

å·²ä¿®å¤ä»£ç é”™è¯¯ï¼š
- `getUserUnlockedSkills()` æ–¹æ³•ä¸­ï¼Œå°† `userCharacter.getPlayerCharacterId()` æ”¹ä¸º `userCharacter.getId()`

ç°åœ¨ä»£ç å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œä½†å»ºè®®è€ƒè™‘æ–¹æ¡ˆ2çš„ä¼˜åŒ–ã€‚

